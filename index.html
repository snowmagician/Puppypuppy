<!DOCTYPE html>
<html>
<head>
    <!-- NATION WIDE BAR CRAWL CREDITS -->
    <!-- PROGRAMMER: JOEY CALCA -->
    <!-- DESIGNER: TYSON STERLING -->
    <!-- SERVERS: MALCOLM FRASIER -->
    <!-- MARKETING: MIKE HINELINE -->
    <!-- BUSINESS: DAVE LORENZI, BRENTON LOPEZ, MISHA BARNES, IAN ELIAS, TOMMY PARK -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">	
	<link rel="stylesheet" type="text/css" href="./css/nwbcmobilesite.css"/>
	<script type="text/javascript" src="./js/jquery-1.7.1.min.js"></script>
	<script type="text/javascript" src="./js/cordova-2.1.0.js"></script>
	<script type="text/javascript" src="./js/iscroll.js"></script>
	<script type="text/javascript">
		var myScroll;
		function loaded() {
			myScroll = new iScroll('wrapper');
		}
		document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
		document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);
	</script>
</head>
<body>

<!-- HEADER -->

<div id="header_logo"><img id="header_logo_loading" src="./images/mobile/header_logo_solid.png" /><img src="./images/mobile/header_logo_text.png" /></div>
<div id="wrapper">
	<div id="scroller">
	
		<!-- GRID SCREEN -->
		
		<div class="hidden transparentbg" id="grid_screen">
			<ul class="mobile_index_ul">
    		    <li class="mobile_index_menu"><a href="#" onClick="showCrawls()"><img src="./images/mobile/grid/crawls.png" /></a></li>
 			    <li class="mobile_index_menu"><a href="#" onClick="profileClicked()"><img src="./images/mobile/grid/profile.png" /></a></li>
				<li class="mobile_index_menu"><a href="#" onClick="showPhotosPage()"><img src="./images/mobile/grid/photos.png" /></a></li>
		    	<li class="mobile_index_menu"><a href="#" onClick="showBarStates()"><img src="./images/mobile/grid/bars.png" /></a></li>
			</ul>
			<ul class="mobile_index_ul">
    		    <li class="mobile_index_menu"><a href="#" onClick="beersMainClicked()"><img src="./images/mobile/grid/beers.png" /></a></li>
		     	<li class="mobile_index_menu"><a href="#" onClick="drinksMainClicked()"><img src="./images/mobile/grid/mixed_drinks.png" /></a></li>
	  		    <li class="mobile_index_menu"><a href="#" onClick="randomBeerClicked()"><img src="./images/mobile/grid/random_beer.png" /></a></li>
 		    	<li class="mobile_index_menu"><a href="#" onClick="randomDrinkClicked()"><img src="./images/mobile/grid/random_drink.png" /></a></li>
			</ul>
			<ul class="mobile_index_ul">
    		    <li class="mobile_index_menu"><a href="#" onClick="showSlotMachine()"><img src="./images/mobile/grid/slot_machine.png" /></a></li>
		     	<li class="mobile_index_menu"><a href="#" onClick="showWeeklyPoll()"><img src="./images/mobile/grid/weekly_poll.png" /></a></li>
    		    <li class="mobile_index_menu"><a href="#" onClick="showSpecials()"><img src="./images/mobile/grid/specials.png" /></a></li>
    		    <li class="mobile_index_menu"><a href="#" onClick="showDrinkingBuddies()"><img src="./images/mobile/grid/drinking_buddies.png" /></a></li>
			</ul>
			<div id="logout_holder"></div>
		</div>
		
		<!-- SLOT MACHINE -->
		
		<div class="hidden transparentbg" id="slot_machine">
			<div id="slot_title"></div>
			<div id="slot_bg_holder">
				<div class="slot_results_holder" id="slot_beer_holder">
					<img id="slot_beer_image" src="" />
					<p class="slot_name" id="slot_beer_name"></p>
				</div>
				<div class="slot_results_holder" id="slot_drink_holder">
					<img id="slot_drink_image" src="" />
					<p class="slot_name" id="slot_drink_name"></p>
				</div>
				<div class="slot_results_holder" id="slot_bar_holder">
					<p id="slot_bar_name"></p>
				</div>
			</div>
			<div id="slot_spin_holder"><img src="./images/mobile/slot_machine_spin.png" /></div>
		</div>
		<div class="hidden transparentbg" id="slot_states_page">
			<p>PICK A STATE</p>
			<ul class="native_ul" id="slot_states_list_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="slot_state_page">
			<p>PICK A DESTINATION</p>
			<ul class="native_ul" id="slot_state_list_ul"></ul>
		</div>
		
		<!-- SPECIALS -->
		
		<div class="hidden transparentbg" id="specials">
			<div id="specials_title"></div>
			<ul class="native_ul">
                    <li><a href="#" onClick="showSpecialsList('Friday')">Friday</a><span class="native_ul_arrow"></span></li>
                    <li><a href="#" onClick="showSpecialsList('Saturday')">Saturday</a><span class="native_ul_arrow"></span></li>
                    <li><a href="#" onClick="showSpecialsList('Sunday')">Sunday</a><span class="native_ul_arrow"></span></li>
                    <li><a href="#" onClick="showSpecialsList('Monday')">Monday</a><span class="native_ul_arrow"></span></li>
                    <li><a href="#" onClick="showSpecialsList('Tuesday')">Tuesday</a><span class="native_ul_arrow"></span></li>
                    <li><a href="#" onClick="showSpecialsList('Wednesday')">Wednesday</a><span class="native_ul_arrow"></span></li>
                    <li><a href="#" onClick="showSpecialsList('Thursday')">Thursday</a><span class="native_ul_arrow"></span></li>
        	</ul>
		</div>
		<div class="hidden transparentbg" id="specials_list_page">
			<p id="specials_dest"></p>
			<p id="specials_day"></p>
			<div class="mobile_hr"></div>
			<div id="specials_list"></div>
		</div>
		<div class="hidden transparentbg" id="specials_states_page">
			<p>PICK A STATE</p>
			<ul class="native_ul" id="specials_states_list_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="specials_state_page">
			<p>PICK A DESTINATION</p>
			<ul class="native_ul" id="specials_state_list_ul"></ul>
		</div>
		
		<!-- PROFILE -->
		
		<div class="hidden transparentbg" id="profile_page">
			<div class="profile_width">
				<p id="profile_name"></p>
				<p id="profile_edit"><a href="#" onClick="showProfileEditPage()"><img src="./images/mobile/profile_edit.png" /></a></p>
			</div>
			<div class="profile_width">
				<div id="profile_image_holder"><img src="" id="profile_image" /></div>
				<p id="profile_score_main"></p>
			</div>
			<div id="profile_info_holder">
				<div id="profile_info"></div>
			</div>
			<img src="./images/mobile/profile_photos.png" />
			<div id="profile_galleries">
				<p><a href="#" onClick="showTakePhotoPage()"><img src="./images/mobile/AddAPicture.png" /></a></p>
				<ul id="profile_galleries_ul"></ul>
			</div>
			<img src="./images/mobile/profile_score.png" />
			<div id="profile_score">
				<p>Beer Score: <span id="beer_score"></span></p>
				<p>Drink Score: <span id="drink_score"></span></p>
				<p>Total Score: <span id="total_score"></span></p>
			</div>
			<img src="./images/mobile/profile_beers.png" />
			<div id="profile_beers">
				<ul id="mobile_profile_beers_ul"></ul>
			</div>
			<img src="./images/mobile/profile_drinks.png" />
			<div id="profile_drinks">
				<div id="add_favorite_drink_button"></div>
				<ul id="mobile_profile_drinks_ul"></ul>
			</div>
			<div class="mobile_hr"></div>
		</div>
		<div class="hidden transparentbg" id="profile_change_favorite_drinks_page">
			<p>DRINKS</p>
			<ul class="native_ul" id="profile_change_favorite_drinks_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="profile_change_favorite_beers_page">
			<p>BEERS</p>
			<ul class="native_ul" id="profile_change_favorite_beers_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="profile_edit_page">
			<div id="profile_edit_info"></div>
			<p><a href="#" onClick="profileChangeImageClicked()"><img src="./images/mobile/ChangeImage.png" /></a></p>
		</div>
		<div class="hidden transparentbg" id="profile_change_favorite_beer_page">
			<p>BEERS</p>
			<ul class="native_ul" id="profile_change_favorite_beer_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="profile_change_favorite_drink_page">
			<p>DRINKS</p>
			<ul class="native_ul" id="profile_change_favorite_drink_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="profile_change_image_page">
			<p>New Profile Image</p>
			<p><a href="#" onClick="profileNewCameraPhoto()"><img src="./images/mobile/camera-btn.png" /></a></p>
			<p><a href="#" onClick="profileNewGalleryPhoto()"><img src="./images/mobile/gallery-btn.png" /></a></p>
		</div>
		<div class="hidden transparentbg" id="profile_friend_requests_page">
			<ul id="profile_friend_requests_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="profile_member1_page">
			<div class="profile_width">
				<p id="profile_member1_name"></p>
				<p id="profile_member1_buddy_button"></p>
			</div>
			<div class="profile_width">
				<div id="profile_member1_image_holder"><img src="" id="profile_image" /></div>
				<p id="profile_member1_score_main"></p>
			</div>
			<div id="profile_member1_info_holder">
				<div id="profile_member1_info"></div>
			</div>
			<img src="./images/mobile/profile_photos.png" />
			<div id="profile_member1_galleries">
				<ul id="profile_member1_galleries_ul"></ul>
			</div>
			<img src="./images/mobile/profile_score.png" />
			<div id="profile_member1_score">
				<p>Beer Score: <span id="profile_member1_beer_score"></span></p>
				<p>Drink Score: <span id="profile_member1_drink_score"></span></p>
				<p>Total Score: <span id="profile_member1_total_score"></span></p>
			</div>
			<img src="./images/mobile/profile_beers.png" />
			<div id="profile_member1_beers">
				<ul id="profile_member1_beers_ul"></ul>
			</div>
			<img src="./images/mobile/profile_drinks.png" />
			<div id="profile_drinks">
				<div id="add_favorite_drink_button"></div>
				<ul id="profile_member1_drinks_ul"></ul>
			</div>
			<div class="mobile_hr"></div>
		</div>
		
		<!-- DRINKING BUDDIES -->
		
		<div class="hidden transparentbg" id="drinking_buddies_page">
			<ul id="drinking_buddies_ul"></ul>
		</div>
		
		<!-- CRAWLS -->
		
		<div class="hidden transparentbg" id="crawls_page">
			<a href="#" onClick="showCreateCrawlStatesPage()"><img src="./images/mobile/crawl_create.png" /></a>
			<a href="#" onClick="showPublicCrawls()"><img id="crawls_public_button" src="./images/mobile/crawls_public.png" /></a>
			<img id="crawls_upcoming" src="./images/mobile/crawls_upcoming.png" />
			<ul id="crawls_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="crawls_public_page">
			<p>Public Crawls for: <span id="crawls_public_dest"></span></p>
			<img id="crawls_upcoming" src="./images/mobile/crawls_upcoming.png" />
			<ul id="crawls_public_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="crawls_single_crawl_page">
			<div id="crawl_top_row">
				<div id="crawl_info">
					<p id="crawl_info_creator_title">Creator:</p>
					<div id="crawl_creator_photo"></div>
					<p id="crawl_info_creator"></p>
				</div>
				<div id="crawl_top_right">
					<p id="crawls_single_crawl_name"></p>
					<p id="crawls_single_crawl_date"></p>
					<p id="crawls_single_crawl_dest"></p>
					<p id="crawl_info_public"></p>
				</div>
			</div>
			<div id="crawls_single_stops"></div>
			<div class="mobile_hr"></div>
			<div id="crawls_single_crawl_add_stop"></div>
			<div id="crawls_single_crawl_attending"></div>
			<div id="crawl_members">
				<p>Attending:</p>
				<ul id="crawl_members_ul_y" class="drinking_buddies_thumb"></ul>
				<div class="mobile_hr"></div>
				<p>Undecided:</p>
				<ul id="crawl_members_ul_u" class="drinking_buddies_thumb"></ul>
				<div class="mobile_hr"></div>
				<p>Not Attending:</p>
				<ul id="crawl_members_ul_n" class="drinking_buddies_thumb"></ul>
			</div>
			<div id="crawl_edit"></div>
		</div>
		<div class="hidden transparentbg" id="crawl_change_status_page">
			<p>Change Crawl Status</p>
			<p id="crawl_change_status_title"></p>
			<p id="crawl_change_status_rsvpstatus"></p>
			<div class="mobile_hr"></div>
			<p>Change Status to:</p>
			<p><a href="#" onClick="crawlChangeStatus('y')">Attending</a></p>
			<p><a href="#" onClick="crawlChangeStatus('u')">Undecided</a></p>
			<p><a href="#" onClick="crawlChangeStatus('n')">Not Attending</a></p>
		</div>
		<div class="hidden transparentbg" id="crawl_add_stop_page">
			<p>ADD A BAR STOP</p>
			<ul class="native_ul" id="crawl_add_stop_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="crawls_create_crawl_states_page">
			<p>NEW CRAWL: PICK A STATE</p>
			<ul class="native_ul" id="crawls_create_crawl_states_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="crawls_create_crawl_state_page">
			<p>NEW CRAWL: PICK A DESTINATION</p>
			<ul class="native_ul" id="crawls_create_crawl_state_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="crawls_create_crawl_dest_page">
			<p>FIRST STOP: PICK A BAR</p>
			<ul class="native_ul" id="crawls_create_crawl_dest_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="crawls_create_crawl_final_page">
			<p id="crawl_destination">Destination: </p>
			<p id="crawl_first_stop">First Stop: </p>
			<form action="" method="POST" data-ajax="false" id="crawl_form" data-ajax="false">
				<label for="name">Title: </label>
				<input type="text" name="title" id="id_title" value="" />
				<label for="select-choice-0" class="select">Crawl Type:</label>
				<select name="type" id="id_type">
					<option value="b">Birthday</option>
					<option value="t">Team Building Exercise</option>
					<option value="o">Other</option>
				</select>
				<fieldset data-role="controlgroup" data-type="horizontal">
				<legend>Date:</legend>
			
				<label for="select-choice-month">Month</label>
				<select name="select-choice-month" id="select-choice-month">
					<option value="01">January</option>
					<option value="02">February</option>
					<option value="03">March</option>
					<option value="04">April</option>
					<option value="05">May</option>
					<option value="06">June</option>
					<option value="07">July</option>
					<option value="08">August</option>
					<option value="09">September</option>
					<option value="10">October</option>
					<option value="11">November</option>
					<option value="12">December</option>
				</select>			

				<label for="select-choice-day">Day</label>
				<select name="select-choice-day" id="select-choice-day">
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">13</option>
					<option value="13">13</option>
					<option value="14">14</option>
					<option value="15">15</option>
					<option value="16">16</option>
					<option value="17">17</option>
					<option value="18">18</option>
					<option value="19">19</option>
					<option value="20">20</option>
					<option value="21">21</option>
					<option value="22">22</option>
					<option value="23">23</option>
					<option value="24">24</option>
					<option value="25">25</option>
					<option value="26">26</option>
					<option value="27">27</option>
					<option value="28">28</option>
					<option value="29">29</option>
					<option value="30">30</option>
					<option value="31">31</option>
				</select>		

				<label for="select-choice-year">Year</label>
				<select name="select-choice-year" id="select-choice-year">
					<option value="2012">2012</option>
					<option value="2013">2013</option>
				</select>
				</fieldset>
				<fieldset data-role="controlgroup" data-type="horizontal">
				<legend>Start Time:</legend>
				
				<label for="select-choice-month">Hour</label>
				<select name="select-choice-hour" id="select-choice-hour">
					<option value="01">1</option>
					<option value="02">2</option>
					<option value="03">3</option>
					<option value="04">4</option>	
					<option value="05">5</option>
					<option value="06">6</option>
					<option value="07">7</option>
					<option value="08">8</option>
					<option value="09">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>

				<label for="select-choice-day">Minutes</label>
				<select name="select-choice-minute" id="select-choice-minute">
					<option value="00">00</option>
					<option value="15">15</option>
					<option value="30">30</option>
					<option value="45">45</option>
				</select>	

				<label for="select-choice-ampm">AM/PM</label>
				<select name="select-choice-ampm" id="select-choice-ampm">
					<option value="pm">PM</option>
					<option value="am">AM</option>
				</select>
			</fieldset>
			<label for="flip-1">Make Crawl Public or Invite Only:</label>
			<select name="isPublic" id="id_isPublic" data-role="slider">
				<option value="i">Invite Only</option>
				<option value="p">Public</option>
			</select>
			<input value="Create Crawl" type="submit">
			<p style="display:none;"><input id="id_date" type="text" name="date" /></p>
			<p style="display:none;"><input id="id_barpk" type="text" name="barpk" /></p>
			</form>
		</div>
		<div class="hidden transparentbg" id="crawls_public_states_page">
			<p>PICK A STATE</p>
			<ul class="native_ul" id="crawls_public_states_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="crawls_public_state_page">
			<p>PICK A DESTINATION</p>
			<ul class="native_ul" id="crawls_public_state_ul"></ul>
		</div>
		
		<!-- PHOTOS -->
		
		<div class="hidden transparentbg" id="photos_page">
			<p><a href="#" onClick="showTakePhotoPage()"><img src="./images/mobile/AddAPicture.png" /></a></p>
			<ul id="mobile_galleries_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="photos_gallery_page">
			<div id="mobile_gallery_title"></div>
			<div>
    			<ul id="mobile_single_gallery_ul"></ul>
			</div>
		</div>
		<div class="hidden transparentbg" id="photos_single_photo_page">
			<div id="photos_photo_holder"></div>
			<div id="photo_tagged_bar"></div>
			<div id="photo_drinks_holder"></div>
			<ul id="photo_drinks_tags_ul" class="drink_thumb"></ul>
			<div id="photo_beers_holder"></div>
			<ul id="photo_beers_tags_ul" class="drink_thumb"></ul>
		</div>
		<div class="hidden transparentbg" id="photos_take_photo_page">
			<p><a href="#" onClick="photosNewCameraPhoto()"><img src="./images/mobile/camera-btn.png" /></a></p>
			<p><a href="#" onClick="photosNewGalleryPhoto()"><img src="./images/mobile/gallery-btn.png" /></a></p>
		</div>
		<div class="hidden transparentbg" id="photo_bar_tag_states_page">
			<p>PICK A STATE</p>
			<ul class="native_ul" id="photo_bar_tag_states_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="photo_bar_tag_state_page">
			<p>PICK A DESTINATION</p>
			<ul class="native_ul" id="photo_bar_tag_state_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="photo_bar_tag_destination_page">
			<p>PICK A BAR</p>
			<ul class="native_ul" id="photo_bar_tag_bars_ul"></ul>
		</div>
		
		<!-- WEEKLY POLL -->
		
		<div class="hidden transparentbg" id="weekly_poll_page"></div>
		
		<!-- DRINKS PAGE FROM FOOTER -->
		
		<div class="hidden transparentbg" id="drinks_footer_button_page">
			<a href="#" onClick="beersMainClicked()"><img src="./images/mobile/drinks_beers.png" /></a>
			<a href="#" onClick="drinksTypeClicked('Mixed Drink')"><img src="./images/mobile/drinks_drinks.png" /></a>
			<a href="#" onClick="drinksTypeClicked('Bomber')"><img src="./images/mobile/drinks_bombers.png" /></a>
			<a href="#" onClick="drinksTypeClicked('Shot')"><img src="./images/mobile/drinks_shots.png" /></a>
			<a href="#" onClick="randomBeerClicked()"><img src="./images/mobile/drinks_random_beer.png" /></a>
			<a href="#" onClick="randomDrinkClicked()"><img src="./images/mobile/drinks_random_drink.png" /></a>
		</div>
		
		<!-- DRINKS -->
		
		<div class="hidden transparentbg" id="drinks_main_page">
			<ul class="native_ul">
				<li><a href="#" onClick="drinksABCClicked()">Alphabetical</a><span class="native_ul_arrow"></span></li>
				<li><a href="#" onClick="drinksTypesClicked()">Types</a><span class="native_ul_arrow"></span></li>
				<li><a href="#" onClick="randomDrinkClicked()">Random Drink</a><span class="native_ul_arrow"></span></li>
			</ul>
		</div>
		<div class="hidden transparentbg" id="drinks_abc_page">
			<p>ALL DRINKS</p>
			<ul class="native_ul" id="drinks_abc_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="drinks_types_page">
			<p>DRINK TYPES</p>
			<ul class="native_ul" id="drinks_types_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="drinks_type_page">
			<ul class="native_ul" id="drinks_type_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="drinks_random_drink_page">
			<div id="drinks_random_drink_image"><img src="" id="random_drink_image_img" /></div>
			<div id="randomDrink_float_left"></div>
			<div id="random_drink_photos_holder"></div>
			<ul id="random_drink_photos" class="drinking_buddies_thumb"></ul>
			<div id="random_drink_members_holder"></div>
			<ul id="random_drink_members" class="drinking_buddies_thumb"></ul>
			<div class="mobile_hr"></div>
		</div>
		<div class="hidden transparentbg" id="drinks_single_drink_page">
			<div id="drinks_single_image"><img src="" id="drinks_single_image_img" /></div>
			<div id="drinks_single_float_left"></div>
			<div id="drinks_single_photos_holder"></div>
			<ul id="drinks_single_photos" class="drinking_buddies_thumb"></ul>
			<div id="drinks_single_members_holder"></div>
			<ul id="drinks_single_members" class="drinking_buddies_thumb"></ul>
			<div class="mobile_hr"></div>
		</div>
		
		<!-- BEERS -->
		
		<div class="hidden transparentbg" id="beers_main_page">
			<ul class="native_ul">
				<li><a href="#" onClick="beersABCClicked()">Alphabetical</a><span class="native_ul_arrow"></span></li>
				<li><a href="#" onClick="beersBreweriesClicked()">Breweries</a><span class="native_ul_arrow"></span></li>
				<li><a href="#" onClick="beersTypesClicked()">Types</a><span class="native_ul_arrow"></span></li>
				<li><a href="#" onClick="beersDomesticsClicked()">Domestics</a><span class="native_ul_arrow"></span></li>
				<li><a href="#" onClick="beersImportsClicked()">Imports</a><span class="native_ul_arrow"></span></li>
				<li><a href="#" onClick="randomBeerClicked()">Random Beer</a><span class="native_ul_arrow"></span></li>
			</ul>
		</div>
		<div class="hidden transparentbg" id="beers_abc_page">
			<p>ALL BEERS</p>
			<ul class="native_ul" id="beers_abc_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="beers_breweries_page">
			<p>BREWERIES</p>
			<ul class="native_ul" id="beers_breweries_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="beers_brewery_page">
			<ul class="native_ul" id="beers_brewery_beer_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="beers_types_page">
			<p>BEER TYPES</p>
			<ul class="native_ul" id="beers_types_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="beers_type_page">
			<ul class="native_ul" id="beers_type_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="beers_domestics_page">
			<p>DOMESTIC BEERS</p>
			<ul class="native_ul" id="beers_domestics_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="beers_imports_page">
			<p>IMPORT BEERS</p>
			<ul class="native_ul" id="beers_imports_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="beers_random_beer_page">
			<div id="beer_image"><img src="" id="random_beer_image_img" /></div>
			<div id="randomBeer_float_left"></div>
			<div id="random_beer_tagged_photos_holder"></div>
			<ul id="random_beer_photos" class="drinking_buddies_thumb"></ul>
			<div id="random_beer_favorite_members_holder"></div>
			<ul id="random_beer_members" class="drinking_buddies_thumb"></ul>
			<div class="mobile_hr"></div>
		</div>
		<div class="hidden transparentbg" id="beers_single_beer_page">
			<div id="single_beer_image"><img src="" id="beers_single_image_img" /></div>
			<div id="single_beer_float_left"></div>
			<div id="single_beer_tagged_photos_holder"></div>
			<ul id="single_beer_photos" class="drinking_buddies_thumb"></ul>
			<div id="single_beer_favorite_members_holder"></div>
			<ul id="single_beer_members" class="drinking_buddies_thumb"></ul>
			<div class="mobile_hr"></div>
		</div>
		
		<!-- BARS -->
		
		<div class="hidden transparentbg" id="single_bar_page">
			<div id="bar_info"></div>
			<div id="bar_tap_info_holder"></div>
			<ul id="bar_beerlist_ul"></ul>
			<div id="bar_bottle_info_holder"></div>
			<ul id="bar_bottlelist_ul"></ul>
			<div id="bar_photos_holder"></div>
			<ul id="bar_photos" class="drinking_buddies_thumb"></ul>
			<div id="bar_members_holder"></div>
			<ul id="bar_members" class="drinking_buddies_thumb"></ul>
			<div class="mobile_hr"></div>
		</div>
		<div class="hidden transparentbg" id="bar_states_page">
			<p>PICK A STATE</p>
			<ul class="native_ul" id="bar_states_list_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="bar_state_page">
			<p>PICK A DESTINATION</p>
			<ul class="native_ul" id="bar_state_list_ul"></ul>
		</div>
		<div class="hidden transparentbg" id="bar_dest_page">
			<p>PICK A BAR</p>
			<ul class="native_ul" id="bar_dest_list_ul"></ul>
		</div>
		
		<!-- LOGIN AND REGISTER -->
		
		<div class="hidden transparentbg" id="home_login_holder">
			<form id="login_form" action="" method="post" data-ajax="false">
				<p>
            		<label for="textinput1">Username: </label>
            		<input name="username" id="username" placeholder="" value="" type="text">
            	</p>
            	<p>
            		<label for="textinput2">Password: </label>
            		<input name="password" id="password" placeholder="" value="" type="password">
            	</p>
        		<input value="LOGIN" type="submit">
    		</form>
    		<p style="text-align:center;">New to NWBC? <a href="#" onClick="registerPageClicked()"><img src="./images/mobile/Register.png" /></a></p>
    		<p style="text-align:center;">Forgot your Password? <a href="#" onClick="resetPasswordClicked()">Reset it!</a></p>
			<div id="login_results"></div>
		</div>
		<div class="hidden transparentbg" id="home_register_holder">
			<form id="register_form" action="" method="post" data-ajax="false">
			<p>
         	   <label for="textinput1">Username: </label>
        	    <input name="username" id="username" placeholder="" value="" type="text">
        	</p>
        	<p>
            	<label for="textinput2">Password: </label>
       	    	<input name="password" id="password" placeholder="" value="" type="password">
            </p>
            <p>
            	<label class="ui-input-text" for="email">Email:</label>
				<input id="email" class="ui-input-text ui-body-c ui-corner-all ui-shadow-inset" type="email" value="" name="email">
			</p>
			<p>
				<label for="favorite_bar">Favorite Bar:</label>
				<select name="favbar" id="favbar">
					<option value="7">Fat Tuesday</option>
					<option value="826">C.A.S.A.</option>
					<option value="4">Bison Witches</option>
					<option value="825">Handlebar</option>
					<option value="17">Zuma</option>
					<option value="659">Canteen</option>
				</select>
			</p>
			<fieldset data-role="controlgroup" data-type="horizontal">
			<legend>Birthday:</legend>
			<select name="month" id="id_month">
				<option value="01">January</option>
				<option value="02">February</option>
				<option value="03">March</option>
				<option value="04">April</option>
				<option value="05">May</option>
				<option value="06">June</option>
				<option value="07">July</option>
				<option value="08">August</option>
				<option value="09">September</option>
				<option value="10">October</option>
				<option value="11">November</option>
				<option value="12">December</option>
			</select>
			<select name="day" id="id_day">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
				<option value="8">8</option>
				<option value="9">9</option>
				<option value="10">10</option>
				<option value="11">11</option>
				<option value="12">13</option>
				<option value="13">13</option>
				<option value="14">14</option>
				<option value="15">15</option>
				<option value="16">16</option>
				<option value="17">17</option>
				<option value="18">18</option>
				<option value="19">19</option>
				<option value="20">20</option>
				<option value="21">21</option>
				<option value="22">22</option>
				<option value="23">23</option>
				<option value="24">24</option>
				<option value="25">25</option>
				<option value="26">26</option>
				<option value="27">27</option>
				<option value="28">28</option>
				<option value="29">29</option>
				<option value="30">30</option>
				<option value="31">31</option>
			</select>
			<select name="year" id="id_year">
				<option value="1991">1991</option>
				<option value="1990">1990</option>
				<option value="1989">1989</option>
				<option value="1988">1988</option>
				<option value="1987">1987</option>
				<option value="1986">1986</option>
				<option value="1985">1985</option>
				<option value="1984">1984</option>
				<option value="1983">1983</option>
				<option value="1982">1982</option>
				<option value="1981">1981</option>
				<option value="1980">1980</option>
				<option value="1979">1979</option>
				<option value="1978">1978</option>
				<option value="1977">1977</option>
				<option value="1976">1976</option>
				<option value="1975">1975</option>
				<option value="1974">1974</option>
				<option value="1973">1973</option>
				<option value="1972">1972</option>
				<option value="1971">1971</option>
				<option value="1970">1970</option>
				<option value="1969">1969</option>
				<option value="1968">1968</option>
				<option value="1967">1967</option>
				<option value="1966">1966</option>
				<option value="1965">1965</option>
				<option value="1964">1964</option>
				<option value="1963">1963</option>
				<option value="1962">1962</option>
				<option value="1961">1961</option>
				<option value="1960">1960</option>
			</select>
			</fieldset>
			<p>I have read and agree to the <a href="./tos.html">Terms of Service</a></p>
			<select name="TOSAgreed" id="id_tosagreed" data-role="slider">
				<option value="y">Agree</option>
				<option value="n">Do Not Agree</option>
			</select>
			<p style="display:none;"><input id="id_birthday" type="text" name="birthday"></p>		
	        <input value="REGISTER" type="submit"> 
	  	  	</form>
		</div>
		<div class="hidden transparentbg" id="home_password_reset_holder">
			<form id="password_reset_form" action="" method="post" data-ajax="false">
				<p>
            		<label for="textinput1">Email: </label>
            		<input id="id_email" type="text" name="email" maxlength="75" />
            	</p>
        		<input value="Reset Password" type="submit">
    		</form>
		</div>
		
		<!-- DATABASE BUSY SCREENS -->
		
		<div class="hidden transparentbg" id="home_database_beers">
			<p>Please wait while I create the Beers Database</p>
		</div>
		<div class="hidden transparentbg" id="home_database_drinks">
			<p>Please wait while I create the Drinks Database</p>
		</div>
		
		<!-- HOME SCREEN -->
		
		<div id="home_buttons_holder">
			<img id="grid_button" class="mobile_right" src="./images/mobile/grid.png" />
			<a href="#" onClick="showSlotMachine()"><img id="slot_button" class="mobile_left" src="./images/mobile/slot_machine.png" /></a>
			<a href="#" onClick="upArrowClicked()"><img id="up_arrow" src="./images/mobile/uparrow.png" /></a>
		</div>
		<div id="home_buttons_conditional">
			<div id="home_buttons_conditional_weeklypoll" class="hidden">
				<a href="#" onClick="showWeeklyPoll();">
					<img src="./images/mobile/TakeWeeklyBeerPoll.png" />
				</a>
			</div>
			<div id="home_buttons_conditional_friendship" class="hidden">
				<a href="#" onClick="profileFriendRequestsPage();">
					<img src="./images/mobile/BuddyRequestsPending.png" />
				</a>
			</div>
		</div>
	</div>
</div>

<!-- FOOTER -->

<div id="home_footer">
	<div class="footer_button">
		<a href="#" onClick="profileClicked()"><img src="./images/mobile/footer_button_profile.png" /></a>
	</div>
	<div class="footer_button">
		<a href="#" onClick="showCrawls()"><img src="./images/mobile/footer_button_crawls.png" /></a>
	</div>
	<div class="footer_button">
		<a href="#" onClick="showSpecials()"><img src="./images/mobile/footer_button_specials.png" /></a>
	</div>
	<div class="footer_button">
		<a href="#" onClick="showDrinksPage()"><img src="./images/mobile/footer_button_drinks.png" /></a>
	</div>
</div>
<script>

	//************************************************************
	//
	// GLOBAL VARIABLES AND SETTINGS
	//
	//************************************************************

	// Variable to pass Data Directory between functions for DB access
	var DATADIR;
	
	// Variables to pass favorite beers and drinks from db to filesystem
	var BEERPK;
	var DRINKPK;
	
	// variable to pass favorite beers and drinks from db to filesystem
	var BEERPKS;
	var DRINKPKS;

	// variable to hold filesystem directory for beers and drinks
	var BEERSDATADIR;
	var DRINKSDATADIR;
	
	// variables to pass beers and drinks pks from json response to database to get images
	var SINGLEPHOTOBEERPKS;
	var SINGLEPHOTODRINKPKS;

	// variables to hold filesystem access
	var SINGLEPHOTOBEERSDATADIR;
	var SINGLEPHOTODRINKSDATADIR;
	
	// Single Bar Variables for filling out bottle and tap lists
	var tapBeersAdded = false;
	var bottleBeersAdded = false;
	
	// variable to set once the beers database has been created
	var dbCreated = localStorage.getItem("dbCreated");

	// variable to set once the drinks database has been created
	var drinksdbCreated = localStorage.getItem("drinksdbCreated");

	// global variable to hold a connection to the database
	var db = window.openDatabase("BEERSDBV4", "1.0", "Beers Database", 500000);
	
	// variable to hold the filesystem for global access
	var fs = null;
	
	// click listener for all native_ul li clicks
	$('.native_ul li').click(function() {
		$(this).addClass('li_clicked');
	});
	
	// variable to check if index needs to be reloaded on upArrowClicked()
	var reloadindex = false;
	
	//************************************************************
	//
	// UP ARROW
	//
	//************************************************************
	
	// hide all visible pages and hide the up arrow
	function upArrowClicked() {
		// if we need to reload the index to refresh the current state
		if (reloadindex == true) {
			window.location.href="index.html";
		}
		$('.hidden').slideUp('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
		});
		$('#up_arrow').hide();
	}
	
	//************************************************************
	//
	// THE GRID
	//
	//************************************************************
	
	// display/hide the grid
	$('#grid_button').click(function() {
		if ($('#grid_screen').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			$('#grid_screen').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
				$('#up_arrow').show();
			});
		}
	});
	
	//************************************************************
	//
	// SLOT MACHINE
	//
	//************************************************************
	
	// display/hide the slot machine
	function showSlotMachine() {
		if ($('#slot_machine').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// fill in slot machine info
			if (localStorage.getItem("slotdest") == null) {
				$('#slot_title').html('<p><a href="#" onClick="showSlotStates()">Choose Destination to Spin for</a></p>');
			} else {
				$('#slot_title').html('<p>Spinning for <a href="#" onClick="showSlotStates()">' + localStorage.getItem("slotdest") + '</a></p>');
			}
			// show the slot machine
			$('#slot_machine').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
			});
			$('#up_arrow').show();
		}
	}
	
	// spin the slot machine
	$('#slot_spin_holder').click(function() {
		var destslug = localStorage.getItem("slotdestslug");
		if (destslug == null) {
			showSlotStates();
		} else {
			showSpinner();
			$.get("http://nationwidebarcrawl.com/mobilenative/spin/" + destslug + "/", function(response) {
				var parsed_data = $.parseJSON(response);
				// fill in random beer image and name
				fillInSlotBeer(parsed_data[0].beerpk);
				$('#slot_beer_name').html(parsed_data[0].beer);
				// fill in random drink image and name
				fillInSlotDrink(parsed_data[0].drinkpk);
				$('#slot_drink_name').html(parsed_data[0].drink);
				// fill in bar name
				$('#slot_bar_name').html(parsed_data[0].bar);
				// if bar is already linked, remove link
				if($('#barlink').length) {
					$('#slot_bar_name').unwrap();
				}
				// add bar link
				$('#slot_bar_name').wrap('<a id="barlink" href="#" onClick="singleBarClicked(' + parsed_data[0].barpk + ')"></a>');
				hideSpinner();
			});
		}
	});
	
	// fill in the beer image for the slot machine
	function fillInSlotBeer(beerpk) {
		// set global var to hold beer pk to get image from filesystem
		BEERPK = beerpk;	
		// get filesystem access for beer images
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSlotBeerFSSuccess, errorHandler);
	}

	// fill in the drink image for the slot machine
	function fillInSlotDrink(drinkpk) {
		// set global var to hold drink pk to get image from filesystem
		DRINKPK = drinkpk;
		// get filesystem access for beer images
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSlotDrinkFSSuccess, errorHandler);
	}

	// got filesystem access for beer images
	function onSlotBeerFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/beers",{create:true},gotSlotBeersDir,onError);
	}

	// got filesystem access for drink images
	function onSlotDrinkFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/drinks",{create:true},gotSlotDrinksDir,onError);
	}

	// got filesystem directory for beer images
	function gotSlotBeersDir(d){
		BEERSDATADIR = d;
		// query the database to get beer image names
		db.transaction(querySlotBeersDB, errorCB, function(){});
	}

	// got filesystem directory for drink images
	function gotSlotDrinksDir(d){
		DRINKSDATADIR = d;
		// query the database to get drink image names
		db.transaction(querySlotDrinksDB, errorCB, function(){});
	}

	// Query the beers database
	function querySlotBeersDB(tx) {
		tx.executeSql('SELECT * FROM beers WHERE id = ' + BEERPK, [], querySlotBeersSuccess, errorCB);
	}

	// Query the drinks database
	function querySlotDrinksDB(tx) {
		tx.executeSql('SELECT * FROM drinks WHERE id = ' + DRINKPK, [], querySlotDrinksSuccess, errorCB);
	}

	// beers database query success callback
	function querySlotBeersSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			addSlotFavoriteBeer(beer.imagename, beer.imageurl, beer.id);
		}
	}

	// drinks database query success callback
	function querySlotDrinksSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			addSlotFavoriteDrink(drink.imagename, drink.imageurl, drink.id);
		}
	}

	// add a beer to the template
	function addSlotFavoriteBeer(imagename, imageurl, id) {
		// get beer files
		BEERSDATADIR.getFile(imagename, {create: false}, function(fileEntry){gotSlotBeerFile(fileEntry, id);}, function(){noSlotBeerFile(imageurl, id);});
	}

	// add a drink to the template
	function addSlotFavoriteDrink(imagename, imageurl, id) {
		// get drink files
		DRINKSDATADIR.getFile(imagename, {create: false}, function(fileEntry){gotSlotDrinkFile(fileEntry, id);}, function(){noSlotDrinkFile(imageurl, id);});
	}

	// add a beer to the favorite beer list in the template
	function gotSlotBeerFile(fileEntry, id) {
		$('#slot_beer_image').attr("src", fileEntry.fullPath);
		// if beer is already linked, remove link
		if($('#beerlink').length) {
			$('#slot_beer_image').unwrap();
		}
		// add beer link to beer image
		$('#slot_beer_image').wrap('<a id="beerlink" href="#" onClick="singleBeerClicked(' + id + ')"></a>');
	}

	// add a drink to the favorite drink list in the template
	function gotSlotDrinkFile(fileEntry, id) {
		$('#slot_drink_image').attr("src", fileEntry.fullPath);
		// if drink is already linked, remove link
		if($('#drinklink').length) {
			$('#slot_drink_image').unwrap();
		}
		// add drink link to drink image
		$('#slot_drink_image').wrap('<a id="drinklink" href="#" onClick="singleDrinkClicked(' + id + ')"></a>');
	}

	// get thumbnail for a beer
	function noSlotBeerFile(imageurl) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = BEERSDATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(fileEntry) {$('#slot_beer_image').attr("src", fileEntry.fullPath);}, null);
		$('#slot_beer_image').wrap('<a id="beerlink" href="#" onClick="singleBeerClicked(' + id + ')"></a>');
	}

	// get thumbnail for a drink
	function noSlotDrinkFile(imageurl) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DRINKSDATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(fileEntry) {$('#slot_drink_image').attr("src", fileEntry.fullPath);}, null);
		$('#slot_drink_image').wrap('<a id="drinklink" href="#" onClick="singleDrinkClicked(' + id + ')"></a>');
	}
	
	// display/hide the state list for setting the destination for the Slot Machine
	function showSlotStates() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#slot_states_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the states list
			$('#slot_states_list_ul').html('');
			// get the states list
			$.get("http://nationwidebarcrawl.com/mobilenative/destinationstatelist/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					var chosenstate = this['state'] + '';
					$('#slot_states_list_ul').append('<li><a href="#" onClick="showSlotState(\'' + chosenstate + '\')">' + this['name'] + '</a><span class="native_ul_arrow"></span></li>');
				});
				// add click event listener to highlight clicked li
				$('#specials ul li').click(function() {
					$(this).addClass('li_clicked');
				});
				// show the specials states page
				$('#slot_states_page').slideDown('slow', function() {
					setTimeout(function() {
						hideSpinner();
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	// display/hide the destination list for selectedstate the destination for the Slot Machine
	function showSlotState(selectedstate) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#slot_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			// set chosen state
			window.localStorage.setItem("chosenstate", selectedstate);
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// variable for when bars db has been created
			var barsDbs = localStorage.getItem("barsDbs");
			barsDbs = String(barsDbs);
			if (barsDbs && barsDbs != "") {
				if (barsDbs.search(selectedstate)!=-1) {
					db.transaction(querySlotStateDB, errorCB, function(){});
				} else {
					db.transaction(populateSlotStateDB, errorCB, successSlotStateCB);
				}
			} else {
				db.transaction(populateSlotStateDB, errorCB, successSlotStateCB);
			}
		}
	}
	
	// Populate the database with bars if db table not already created
	function populateSlotStateDB(tx) {
		tx.executeSql('CREATE TABLE IF NOT EXISTS bars(id INTEGER, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website)');
		$.ajaxSetup({async: false});
		// get chosen state
		var selectedstate = window.localStorage.getItem("chosenstate");
		$.get("http://nationwidebarcrawl.com/mobilenative/barstatelist/" + selectedstate + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			var len = parsed_data.length
			var remaining_length = parsed_data.length;
			var begin_counter = 0;
			while (remaining_length > 0) {
				addRowsToSlotStateTable(parsed_data.slice(begin_counter, begin_counter+500), tx);
				begin_counter += 500;
				remaining_length -= 500;
			}
			localStorage.setItem("barsDbCreated", "1");
			var donedbs = localStorage.getItem("barsDbs");
			donedbs += ", " + selectedstate;
			localStorage.setItem("barsDbs", donedbs);
		});
	}
	
	// Add rows to the table for each bar
	function addRowsToSlotStateTable(bars, tx) {
		for(var i=0;i<bars.length;i++){
			var bar = bars[i];
			barVarString = [bar['pk'], bar['name'], bar['slug'], bar['location'], bar['address'], bar['destination'], bar['destination_slug'], bar['phone'], bar['city'], bar['state'], bar['statekey'], bar['website']];
			tx.executeSql('INSERT INTO bars (id, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)', barVarString);
		}
	}
	
	// Slot State DB Success Callback, executes after bars db is created for the first time from the slot machine
	function successSlotStateCB() {
		db.transaction(querySlotStateDB, errorCB);
	}
	
	// Query the database for destination information for slot_state_page
	function querySlotStateDB(tx) {
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('SELECT DISTINCT destination, city, destination_slug FROM bars WHERE statekey = ?', [selectedstate], querySlotStateSuccess, errorCB);
	}
	
	// Slot State Query Success Callback
	function querySlotStateSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#slot_state_list_ul').append('<li><a href="#" onClick="newSlotDest(\'' + bar.destination + '\', \'' + bar.destination_slug + '\')">' + bar.destination + ' - ' + bar.city + '</a></li>');
		}
		// show the slot state page
		$('#slot_state_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	
	// accessor method to set the new destination for the specials
	function newSlotDest(chosendest, chosendestslug) {
		window.localStorage.setItem("slotdest", chosendest);
		window.localStorage.setItem("slotdestslug", chosendestslug); 
		showSlotMachine();
	}
	
	//************************************************************
	//
	// CRAWLS
	//
	//************************************************************
	
	// display/hide the crawls page
	function showCrawls() {
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#crawls_page').is(':visible')) {
				upArrowClicked();
			} else {
				showSpinner();
				$('.hidden:visible').slideUp('slow');
				// clear the crawls ul
				$('#crawls_ul').html('');
				// fill in the crawls ul
				$.get("http://nationwidebarcrawl.com/mobilenative/crawls/", function(response) {
					var parsed_data = $.parseJSON(response);
					$.each(parsed_data, function() {
						$('#crawls_ul').append('<li><a href="#" onClick="crawlClicked(\'' + this['pk'] + '\')"><p class="crawls_list_name">' + this['title'] + '</p><p class="crawls_list_dest">' + this['destination'] + '</p><div class="crawls_list_bottom"><p class="crawls_list_status ' + this['attending'] + '">' + this['attending'] + '</p><p class="crawls_list_date">' + this['date'] + '</p></div></a></li>');
					});
					// add the click listener to highlight li blue when clicked
					$('#crawls_ul li').click(function() {
						$(this).addClass('li_clicked');
					});
					$('#crawls_page').slideDown('slow', function() {
						setTimeout(function() {
							myScroll.refresh();
							hideSpinner();
						}, 0);
					});
					$('#up_arrow').show();
				});
			}
		}
	}
	
	// crawl clicked, get info and show crawls_single_crawl_page
	function crawlClicked(chosencrawl) {
		window.localStorage.setItem("chosencrawl", chosencrawl);
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#crawls_single_crawl_page').is(':visible')) {
				upArrowClicked();
			} else {
				showSpinner();
				$('.hidden:visible').slideUp('slow');
				$('#crawl_info_creator').html('');
				$('#crawl_info_public').html('');
				$('#crawl_creator_photo').html('');
				$('#crawls_single_crawl_name').html('');
				$('#crawls_single_crawl_date').html('');
				$('#crawls_single_crawl_dest').html('');
				$('#crawls_single_crawl_add_stop').html('');
				$('#crawls_single_crawl_attending').html('');
				$('#crawl_members_ul_y').html('');
				$('#crawl_members_ul_u').html('');
				$('#crawl_members_ul_n').html('');
				$('#crawl_edit').html('');
				$.get("http://nationwidebarcrawl.com/mobilenative/crawls/" + chosencrawl + "/", function(response) {
					var parsed_data = $.parseJSON(response);
					crawl = parsed_data['crawl'];
					$('#crawl_info_creator').append(crawl['creator']);
					// if crawl is public or invite only
					if (crawl['isPublic']) {
						$('#crawl_info_public').append('PUBLIC CRAWL');
					} else {
						$('#crawl_info_public').append('INVITE ONLY');
					}
					
					// get avatar for crawl creator
					$('#crawl_creator_photo').append('<img src="http://nationwidebarcrawl.com/mobilenative/profile/avatar/' + crawl['creator'] + '/" />');

					// set info for upper right on crawl page
					$('#crawls_single_crawl_name').append(crawl['title']);
					$('#crawls_single_crawl_date').append(crawl['date']);
					$('#crawls_single_crawl_dest').append(crawl['destination']);

					// clear bar stops from last loaded crawl
					$('#crawls_single_stops').html('<table id="mobile_crawl_stops_table"><tr><td class="crawl_info_header">BAR</td><td class="crawl_info_header">TIME</td><td class="crawl_info_header">DURATION</td></tr></table>');
				
					// add bar stops
					$.each(parsed_data['bars'], function() {
						var timestamp = this['timestamp'];
						timestamp = timestamp.substring(timestamp.indexOf(" "));
						timestamp = timestamp.substring(1, timestamp.lastIndexOf(":"));
						hours = timestamp.substring(0, timestamp.indexOf(":"));
						if (hours == 00) {
							hours = 12;
							timestamp = hours + timestamp.substring(timestamp.indexOf(":")) + " AM";
						}
						if (hours < 12) {
							// remove leading 0 from 1 digit hours
							if (hours.charAt(0) == 0) {
								hours = hours.charAt(1);
							}
							timestamp = hours + timestamp.substring(timestamp.indexOf(":")) + " AM";
						}
						if (hours > 12) {
							hours = hours - 12;
							timestamp = hours + timestamp.substring(timestamp.indexOf(":")) + " PM";
						}
						$('#mobile_crawl_stops_table').append('<tr><td><a href="#" onClick="singleBarClicked(\'' + this['barpk'] + '\')">' + this['bar'] + '</a></td><td>' + timestamp + '</td><td>' + this['duration'] + 'min.</td></tr>');
					});
				
					// if isCreator, add 'Add Another Stop' button
					if (crawl['isCreator']) {
						$('#crawls_single_crawl_add_stop').append('<p><a href="#" onClick="showCrawlAddStopPage(\'' + chosencrawl + '\', \'' + crawl['destination'] + '\')"><img src="./images/mobile/AddAnotherStop.png" /></a></p><div class="mobile_hr"></div>');
					}
					
					// if RSVP object, append status and change status button
					if (crawl['hasRSVP']) {
						$('#crawls_single_crawl_attending').append('<p>RSVP Status: <a href="#" onClick="showCrawlChangeStatusPage(\'' + crawl['title'] + '\', \'' + crawl['hasRSVPStatus'] + '\', \'' + chosencrawl + '\')">' + crawl['hasRSVPStatus'] + '</a></p><div class="mobile_hr"></div>');
					}
					
					// if no RSVP object and crawl isPublic, add join crawl button
					if (!crawl['hasRSVP'] && crawl['isPublic']) {
						$('#crawls_single_crawl_attending').append('<p><a href="#" onClick="crawlJoin(\'' + chosencrawl + '\')">JOIN CRAWL</a></p><div class="mobile_hr"></div>');
					}
								
					// add attending members
					$.each(parsed_data['members'], function() {
						if(this['status'] == "y") {
							$('#crawl_members_ul_y').append('<li><a href="#" onClick="profileUserClicked(' + this['memberpk'] + ')"><img src="http://nationwidebarcrawl.com/mobilenative/profile/avatar/' + this['member'] + '/" /></a></li>');
						}
						if(this['status'] == "u") {
							$('#crawl_members_ul_u').append('<li><a href="#" onClick="profileUserClicked(' + this['memberpk'] + ')"><img src="http://nationwidebarcrawl.com/mobilenative/profile/avatar/' + this['member'] + '/" /></a></li>');
						}
						if(this['status'] == "n") {
							$('#crawl_members_ul_n').append('<li><a href="#" onClick="profileUserClicked(' + this['memberpk'] + ')"><img src="http://nationwidebarcrawl.com/mobilenative/profile/avatar/' + this['member'] + '/" /></a></li>');
						}
					});
			
					// TODO: add in edit settings button, first must finish edit settings pages
					// if isCreator, add 'Edit Crawl Settings' button
					//if (crawl['isCreator']) {
					//	$('#crawl_edit').append('<div class="hr_white"></div><p><a href="./crawledit.html" rel="external"><img src="./images/mobile/EditCrawlSettings.png" /></a></p>');
					//}
					
					// show the single crawl page
					$('#crawls_single_crawl_page').slideDown('slow', function() {
						setTimeout(function() {
							myScroll.refresh();
							hideSpinner();
						}, 0);
					});
					$('#up_arrow').show();
				});
			}
		}
	}
	
	// join a crawl, creates the RSVP object for a public crawl
	function crawlJoin(chosencrawl) {
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			showSpinner();
			// hide visible windows
			upArrowClicked();
			// create the RSVP object
			$.get("http://nationwidebarcrawl.com/mobilenative/crawls/" + chosencrawl + "/join/", function(response) {
				hideSpinner();
				showCrawls();
			});
		}
	}
	
	// display/hide the crawl change status page
	function showCrawlChangeStatusPage(title, rsvpstatus, chosencrawl) {
		window.localStorage.setItem("chosencrawl", chosencrawl);
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#crawl_change_status_page').is(':visible')) {
				upArrowClicked();
			} else {
				$('.hidden:visible').slideUp('slow');
				// clear current crawl status options
				// clear current crawl status and fill in new info
				$('#crawl_change_status_title').html('Crawl: ' + title);
				$('#crawl_change_status_rsvpstatus').html('Current Status: ' + rsvpstatus);
				// show crawl change status page
				$('#crawl_change_status_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			}
		}
	}
	
	// crawl status change clicked, modify RSVP object and show the crawl page
	function crawlChangeStatus(newstatus) {
		var chosencrawl = window.localStorage.getItem("chosencrawl");
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			showSpinner();
			$.post("http://nationwidebarcrawl.com/mobilenative/crawls/" + chosencrawl + "/changestatus/", { newstatus: newstatus }, function(response) {
				hideSpinner();
				crawlClicked(chosencrawl);
			});
		}
	}
	
	// display/hide the crawl add stop page
	function showCrawlAddStopPage(chosencrawl, selecteddest) {
		window.localStorage.setItem("chosencrawl", chosencrawl);
		window.localStorage.setItem("chosendest", selecteddest);
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#crawl_add_stop_page').is(':visible')) {
				upArrowClicked();
			} else {
				$('.hidden:visible').slideUp('slow');
				// clear current crawl add ul
				$('#crawl_add_stop_ul').html('');
				// variable to hold database
				db.transaction(queryAddStopDB, errorCB, function(){});
			}
		}
	}
	
	// Query the database for bars list to add stop to crawl
	function queryAddStopDB(tx) {
		var selecteddest = window.localStorage.getItem("chosendest");
		tx.executeSql('SELECT name, id FROM bars WHERE destination = ?', [selecteddest], queryAddStopSuccess, errorCB);
	}
	
	// Add Stop DB Query Success Callback
	function queryAddStopSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#crawl_add_stop_ul').append('<li><a href="#" onClick="addStopBarClicked(\'' + bar.id + '\')">' + bar.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the add stop page
		$('#crawl_add_stop_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 0);
		});
		$('#up_arrow').show();
	}
	
	// Stop Chosen, add the stop to the bar crawl
	function addStopBarClicked(chosenbar) {
		// variable to hold selected crawl for URL
		var selectedCrawl = localStorage.getItem("chosencrawl");
		// GET to add the stop to the crawl
		$.get("http://nationwidebarcrawl.com/mobilenative/crawls/addstop/" + selectedCrawl + "/" + chosenbar + "/", function(response) {
            //parse the response string into an object
            var crawl_info = $.parseJSON(response);
            localStorage.setItem("chosencrawl", crawl_info['crawlpk']);
            crawlClicked(crawl_info['crawlpk']);
		});
	}
	
	// display/hide public crawls page
	function showPublicCrawls() {
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#crawls_public_page').is(':visible')) {
				upArrowClicked();
			} else {
				showSpinner();
				var chosendestslug = window.localStorage.getItem("chosendestslug");
				$('.hidden:visible').slideUp('slow');
				// clear the crawls ul
				$('#crawls_public_ul').html('');
				// fill in the crawls ul
				$.get("http://nationwidebarcrawl.com/mobilenative/crawls/public/" + chosendestslug + "/", function(response) {
					var parsed_data = $.parseJSON(response);
					$.each(parsed_data, function() {
						$('#crawls_public_ul').append('<li><a href="#" onClick="crawlClicked(\'' + this['pk'] + '\')"><p class="crawls_list_name">' + this['title'] + '</p><p class="crawls_list_dest">' + this['destination'] + '</p><div class="crawls_list_bottom"><p class="crawls_list_status ' + this['attending'] + '">' + this['attending'] + '</p><p class="crawls_list_date">' + this['date'] + '</p></div></a></li>');
					});
					$('#crawls_public_dest').html('');
					$('#crawls_public_dest').append('<a href="#" onClick="showPublicCrawlsStatesPage()">' + localStorage.getItem("chosendest") + '</a>');
					$('#crawls_public_page').slideDown('slow', function() {
						setTimeout(function() {
							myScroll.refresh();
							hideSpinner();
						}, 0);
					});
					$('#up_arrow').show();
				});
			}
		}
	}
	
	// display/hide the public crawls states page
	function showPublicCrawlsStatesPage() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#crawls_public_states_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the states list
			$('#crawls_public_states_ul').html('');
			$.get("http://nationwidebarcrawl.com/mobilenative/destinationstatelist/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					var chosenstate = this['state'] + '';
					$('#crawls_public_states_ul').append('<li><a href="#" onClick="showPublicCrawlsStatePage(\'' + chosenstate + '\')">' + this['name'] + '</a><span class="native_ul_arrow"></span></li>');
				});
				$('#crawls_public_states_page').slideDown('slow', function() {
					setTimeout(function() {
						hideSpinner();
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	// display/hide the public crawls destination page
	function showPublicCrawlsStatePage(selectedstate) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#crawls_public_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			window.localStorage.setItem("chosenstate", selectedstate);
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the state list
			$('#crawls_public_state_ul').html('');
			// variable to set once bars db has been created
			var barsDbs = localStorage.getItem("barsDbs");
			barsDbs = String(barsDbs);
			// check if barsDbs is empty
			if (barsDbs && barsDbs != "") {
				if (barsDbs.search(selectedstate)!=-1) {
					db.transaction(queryPublicCrawlsDB, errorCB, function(){});
				} else {
					db.transaction(populateCrawlsPublicDB, errorCB, successPublicCrawlsCB);
    			}
			} else {
				db.transaction(populateCrawlsPublicDB, errorCB, successPublicCrawlsCB);
			}
		}
	}
	
	// Populate the database with bars for public crawls
	function populateCrawlsPublicDB(tx) {
		tx.executeSql('CREATE TABLE IF NOT EXISTS bars(id INTEGER, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website)');
		$.ajaxSetup({async: false});
		// get variable for selectedstate
		var selectedstate = window.localStorage.getItem("chosenstate");
		$.get("http://nationwidebarcrawl.com/mobilenative/barstatelist/" + selectedstate + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			var len = parsed_data.length
			var remaining_length = parsed_data.length;
			var begin_counter = 0;
			while (remaining_length > 0) {
				addRowsToPublicCrawlsTable(parsed_data.slice(begin_counter, begin_counter+500), tx);
				begin_counter += 500;
				remaining_length -= 500;
			}
			localStorage.setItem("dbCreated", "1");
			localStorage.setItem("barsDbCreated", "1");
			var donedbs = localStorage.getItem("barsDbs");
			donedbs += ", " + selectedstate;
			localStorage.setItem("barsDbs", donedbs);
		});
	}
	
	// Add rows to the table for each bar for public crawls
	function addRowsToPublicCrawlsTable(bars, tx) {
		for(var i=0;i<bars.length;i++) {
			var bar = bars[i];
			barVarString = [bar['pk'], bar['name'], bar['slug'], bar['location'], bar['address'], bar['destination'], bar['destination_slug'], bar['phone'], bar['city'], bar['state'], bar['statekey'], bar['website']];
			tx.executeSql('INSERT INTO bars (id, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)', barVarString);
		}
	}
	
	// Public Crawls DB Transaction success callback
	function successPublicCrawlsCB() {
		db.transaction(queryPublicCrawlsDB, errorCB);
	}
	
	// Query the database for bars for public crawls page
	function queryPublicCrawlsDB(tx) {
		// get variable for selectedstate
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('SELECT DISTINCT destination, city, destination_slug FROM bars WHERE statekey = ?', [selectedstate], queryPublicCrawlsSuccess, errorCB);
	}
	
	// Public Crawls DB Query Success Callback
	function queryPublicCrawlsSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#crawls_public_state_ul').append('<li><a href="#" onClick="publicCrawlsNewDest(\'' + bar.destination + '\', \'' + bar.destination_slug + '\')">' + bar.destination + ' - ' + bar.city + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#crawls_public_state_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 0);
		});
		$('#up_arrow').show();
	}
	
	// set new destination for public crawls page
	function publicCrawlsNewDest(chosendest, chosendestslug) {
		window.localStorage.setItem("chosendest", chosendest); 
		window.localStorage.setItem("chosendestslug", chosendestslug);
		showPublicCrawls();
	}
	
	// display/hide the create a crawl states page
	function showCreateCrawlStatesPage() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#crawls_create_crawl_states_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the states list
			$('#crawls_create_crawl_states_ul').html('');
			$.get("http://nationwidebarcrawl.com/mobilenative/destinationstatelist/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					var chosenstate = this['state'] + '';
					$('#crawls_create_crawl_states_ul').append('<li><a href="#" onClick="showCreateCrawlStatePage(\'' + chosenstate + '\')">' + this['name'] + '</a><span class="native_ul_arrow"></span></li>');
				});
				$('#crawls_create_crawl_states_page').slideDown('slow', function() {
					setTimeout(function() {
						hideSpinner();
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	// display/hide the create a crawl state page
	function showCreateCrawlStatePage(selectedstate) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#crawls_create_crawl_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// set variable for selected state
			window.localStorage.setItem("chosenstate", selectedstate);
			showSpinner();
			// clear the states list
			$('#crawls_create_crawl_state_ul').html('');
			// variable for when bars db has been created
			var barsDbs = localStorage.getItem("barsDbs");
			barsDbs = String(barsDbs);
			// check if barsDbs is empty
			if (barsDbs && barsDbs != "") {
				if (barsDbs.search(selectedstate)!=-1) {
					db.transaction(queryCrawlsCreateDB, errorCB, function(){});
				} else {
					db.transaction(populateCreateCrawlDB, errorCB, successCrawlsCreateCB);
				}
			} else {
				db.transaction(populateCreateCrawlDB, errorCB, successCrawlsCreateCB);
			}
		}
	}
	
	// Populate the database with bars for create crawl state list
	function populateCreateCrawlDB(tx) {
		// get selected state
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('CREATE TABLE IF NOT EXISTS bars(id INTEGER, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website)');
		$.ajaxSetup({async: false});
		$.get("http://nationwidebarcrawl.com/mobilenative/barstatelist/" + selectedstate + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			var len = parsed_data.length
			var remaining_length = parsed_data.length;
			var begin_counter = 0;
			while (remaining_length > 0) {
				addRowsToCrawlsCreateTable(parsed_data.slice(begin_counter, begin_counter+500), tx);
				begin_counter += 500;
				remaining_length -= 500;
			}
			localStorage.setItem("dbCreated", "1");
			localStorage.setItem("barsDbCreated", "1");
			var donedbs = localStorage.getItem("barsDbs");
			donedbs += ", " + selectedstate;
			localStorage.setItem("barsDbs", donedbs);
		});
	}
	
	// Add rows to the table for each bar for crawls create state
	function addRowsToCrawlsCreateTable(bars, tx) {
		for(var i=0;i<bars.length;i++) {
			var bar = bars[i];
			barVarString = [bar['pk'], bar['name'], bar['slug'], bar['location'], bar['address'], bar['destination'], bar['destination_slug'], bar['phone'], bar['city'], bar['state'], bar['statekey'], bar['website']];
			tx.executeSql('INSERT INTO bars (id, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)', barVarString);
		}
	}
	
	// Crawls Create DB Query Success Callback
	function successCrawlsCreateCB() {
		db.transaction(queryCrawlsCreateDB, errorCB);
	}
	
	// Query the database for crawls create state page
	function queryCrawlsCreateDB(tx) {
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('SELECT DISTINCT destination, city FROM bars WHERE statekey = ?', [selectedstate], queryCrawlsCreateSuccess, errorCB);
	}
	
	// Create Crawl DB Query Success Callback
	function queryCrawlsCreateSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++) {
			var bar = results.rows.item(i);
			$('#crawls_create_crawl_state_ul').append('<li><a href="#" onClick="showCreateCrawlDestPage(\'' + bar.destination + '\')">' + bar.destination + ' - ' + bar.city + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#crawls_create_crawl_state_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 0);
		});
		$('#up_arrow').show();
	}
	
	// display/hide the create a crawl dest page
	function showCreateCrawlDestPage(selecteddest) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#crawls_create_crawl_dest_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// set variable for selected state
			window.localStorage.setItem("chosendest", selecteddest);
			db.transaction(queryCrawlCreateDestDB, errorCB, function(){});
		}
	}
	
	// Query the database for the list of bars in a destination to use as a first stop on a new crawl
	function queryCrawlCreateDestDB(tx) {
		var selecteddest = window.localStorage.getItem("chosendest");
		tx.executeSql('SELECT name, id FROM bars WHERE destination = ?', [selecteddest], queryCrawlCreateDestSuccess, errorCB);
	}
	
	// Crawl Create bars for dest DB Query Success Callback
	function queryCrawlCreateDestSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#crawls_create_crawl_dest_ul').append('<li><a href="crawlcreatefinal.html" onClick="crawlCreateBarFinal(\'' + bar.id + '\')">' + bar.name + '</a></li>');
		}
		$('#crawls_create_crawl_dest_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 0);
		});
		$('#up_arrow').show();
	}
	
	// TODO: this function should be replaced by the one below it
	// need to figure out how to deal with iscroll and form fields
	function crawlCreateBarFinal(chosenbar) {
		window.localStorage.setItem("crawlfirststop", chosenbar); 
		return true;
	}
	
	// Crawl Create final, the form page to create a new crawl
	function crawlCreateFinal(crawlfirststop) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#crawls_create_crawl_final_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// variable to set once the bars database has been created
			window.localStorage.setItem("crawlfirststop", crawlfirststop);
			showSpinner();
    		db.transaction(queryCreateCrawlFinalDB, errorCB, function(){});
    	}
    }
    
    // Query the database to get bar information for first stop in new crawl for crate crawl final
	function queryCreateCrawlFinalDB(tx) {
		// variable to set once the bars database has been created
		var crawlfirststop = window.localStorage.getItem("crawlfirststop");
		tx.executeSql('SELECT * FROM bars WHERE id = ?', [crawlfirststop], queryCrawlFinalSuccess, errorCB);
	}
	
	// Crawl Create Final DB Query Success Callback
	function queryCrawlFinalSuccess(tx, results) {
		var bar = results.rows.item(0);
		$('#crawl_destination').html(bar.destination);
		$('#crawl_first_stop').html(bar.name);
		$("#id_barpk").val(bar.id);
		$('#crawls_create_crawl_final_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 0);
		});
		$('#up_arrow').show();
	}
	
	//************************************************************
	//
	// SPECIALS
	//
	//************************************************************
	
	// display/hide specials
	function showSpecials() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#specials').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// fill in specials info
			if (localStorage.getItem("specialsdest") == null) {
				$('#specials_title').html('<p><a href="#" onClick="showSpecialsStates()">Choose a Destination for Specials</a></p>');
			} else {
				$('#specials_title').html('<p>Specials for <a href="#" onClick="showSpecialsStates()">' + localStorage.getItem("specialsdest") + '</a></p>');
			}
			// add click event listener to highlight clicked li
			$('#specials ul li').click(function() {
				$(this).addClass('li_clicked');
			});
			// show the specials page
			$('#specials').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
			});
			$('#up_arrow').show();
		}
	}
	
	// set the day for the specials
	function dayClicked(chosenday) {
		window.localStorage.setItem("specialsday", chosenday);
		return true;
	}
	
	// display/hide the specials list page
	function showSpecialsList(specialsday) {
		if ($('#specials_list_page').is(':visible')) {
			upArrowClicked();
		} else {
			showSpinner();
			$('.hidden:visible').slideUp('slow');
			// clear the specials info
			$('#specials_day').html('');
			$('#specials_dest').html('');
			$('#specials_list').html('');
			// fill in the specials
			var selecteddest = window.localStorage.getItem("specialsdestslug");
            if (selecteddest == null) {
				navigator.notification.alert('Please pick a destination for Drink Specials', null, '', 'Select Destination');
				showSpecialsStates();
			}
			$('#specials_dest').html('Specials for <a href="./bardest.html" onClick="destClicked(\'' + window.localStorage.getItem("specialsdest") + '\')">' + window.localStorage.getItem("specialsdest") + '</a>');
			$('#specials_day').html('on ' + specialsday); 
            $.get("http://nationwidebarcrawl.com/mobilenative/specials/" + selecteddest + "/" + specialsday + "/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					$('#specials_list').append('<p class="specials_bar_name"><a href="#" onClick="singleBarClicked(\'' + this['barpk'] + '\')">' + this['bar'] + '</a></p><p>' + this['special'] + '</p><div class="mobile_hr"></div>');
				});
				$('#specials_list_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
						hideSpinner();
					}, 500);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	// display/hide the state list for setting specials destination
	function showSpecialsStates() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#specials_states_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the states list
			$('#specials_states_list_ul').html('');
			// get the states list
			$.get("http://nationwidebarcrawl.com/mobilenative/destinationstatelist/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					var chosenstate = this['state'] + '';
					$('#specials_states_list_ul').append('<li><a href="#" onClick="showSpecialsState(\'' + chosenstate + '\')">' + this['name'] + '</a><span class="native_ul_arrow"></span></li>');
				});
				// add click event listener to highlight clicked li
				$('#specials ul li').click(function() {
					$(this).addClass('li_clicked');
				});
				// show the specials states page
				$('#specials_states_page').slideDown('slow', function() {
					setTimeout(function() {
						hideSpinner();
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	// display/hide the destination list for setting specials destination
	function showSpecialsState(selectedstate) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#specials_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			window.localStorage.setItem("chosenstate", selectedstate);
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the destination list
			$('#specials_state_list_ul').html('');
			// check if barsDbs is empty
			var barsDbs = localStorage.getItem("barsDbs");
			barsDbs = String(barsDbs);
			if (barsDbs && barsDbs != "") {
				if (barsDbs.search(selectedstate)!=-1) {
					db.transaction(querySpecialsStateDB, errorCB, function(){});
				} else {
					db.transaction(populateSpecialsStateDB, errorCB, successSpecialsStateCB);
				}
			} else {
				db.transaction(populateSpecialsStateDB, errorCB, successSpecialsStateCB);
			}
		}
	}
	
	// Populate the database with bar information for bars in selectedstate
	function populateSpecialsStateDB(tx) {
		tx.executeSql('CREATE TABLE IF NOT EXISTS bars(id INTEGER, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website)');
		$.ajaxSetup({async: false});
		var selectedstate = window.localStorage.getItem("chosenstate");
		$.get("http://nationwidebarcrawl.com/mobilenative/barstatelist/" + selectedstate + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			var len = parsed_data.length
			var remaining_length = parsed_data.length;
			var begin_counter = 0;
			while (remaining_length > 0) {
				addRowsToSpecialsStateTable(parsed_data.slice(begin_counter, begin_counter+500), tx);
				begin_counter += 500;
				remaining_length -= 500;
			}
			window.localStorage.setItem("barsDbCreated", "1");
			var donedbs = window.localStorage.getItem("barsDbs");
			donedbs += ", " + selectedstate;
			window.localStorage.setItem("barsDbs", donedbs);
		});
	}
	
	// Add rows to the table with bar info for Specials State
	function addRowsToSpecialsStateTable(bars, tx) {
		for(var i=0;i<bars.length;i++) {
			var bar = bars[i];
			barVarString = [bar['pk'], bar['name'], bar['slug'], bar['location'], bar['address'], bar['destination'], bar['destination_slug'], bar['phone'], bar['city'], bar['state'], bar['statekey'], bar['website']];
			tx.executeSql('INSERT INTO bars (id, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)', barVarString);
		}
	}
	
	// Specials State DB Query Success Callback
	function successSpecialsStateCB() {
		db.transaction(querySpecialsStateDB, errorCB);
	}
	
	// Query the database for destination list for selectedstate for Specials State page
	function querySpecialsStateDB(tx) {
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('SELECT DISTINCT destination, city, destination_slug FROM bars WHERE statekey = ?', [selectedstate], querySpecialsStateSuccess, errorCB);
	}
	
	// got destination list from DB, fill it in to the template
	function querySpecialsStateSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++) {
			var bar = results.rows.item(i);
			$('#specials_state_list_ul').append('<li><a href="#" onClick="newSpecialsDest(\'' + bar.destination + '\', \''+ bar.destination_slug + '\')">' + bar.destination + ' - ' + bar.city + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the specials state page
		$('#specials_state_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	
	// accessor method to set the new destination for the specials
	function newSpecialsDest(chosendest, chosendestslug) {
		window.localStorage.setItem("specialsdest", chosendest);
		window.localStorage.setItem("specialsdestslug", chosendestslug); 
		showSpecials();
	}
	
	//************************************************************
	//
	// PHOTOS
	//
	//************************************************************
	
	// display/hide the photos page
	function showPhotosPage() {
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#photos_page').is(':visible')) {
				upArrowClicked();
			} else {
				showSpinner();
				$('.hidden:visible').slideUp('slow');
				// clear the galleries
				$('#mobile_galleries_ul').html('');
				// fill in the galleries ul
				$.get("http://nationwidebarcrawl.com/mobilenative/photos/", function(response) {
					var parsed_data = $.parseJSON(response);
					$.each(parsed_data, function() {
						var chosengallery = this['gallerypk'];
						$('#mobile_galleries_ul').append('<li class="mobile_left"><a href="#" rel="external" onClick="galleryClicked(\'' + chosengallery + '\')"><img src="http://nationwidebarcrawl.com' + this['73x71'] + '" /></a><p>' + this['name'] + '</p></li>');
					});
					$('#photos_page').slideDown('slow', function() {
						setTimeout(function() {
							myScroll.refresh();
							hideSpinner();
						}, 0);
					});
					$('#up_arrow').show();
				});
			}
		}
	}
	
	// display/hide the photos gallery page
	function galleryClicked(chosengallery) {
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#photos_gallery_page').is(':visible')) {
				upArrowClicked();
			} else {
				showSpinner();
				$('.hidden:visible').slideUp('slow');
				// clear the gallery and gallery title
				$('#mobile_single_gallery_ul').html('');
				$('#mobile_gallery_title').html('');
				// fill in the galleries ul
				$.get("http://nationwidebarcrawl.com/mobilenative/photos/gallery/" + chosengallery + '/', function(response) {
					var parsed_data = $.parseJSON(response);
					$('#mobile_gallery_title').append('<p>' + parsed_data['name'] + '</p>');
					$.each(parsed_data['photos'], function() {
						$('#mobile_single_gallery_ul').append('<li class="mobile_left"><a href="#" onClick="photoClicked(\'' + this['pk'] + '\')"><img src="http://nationwidebarcrawl.com' + this['mobilethumb'] + '" /></a></li>');
					});
					$('#photos_gallery_page').slideDown('slow', function() {
						setTimeout(function() {
							myScroll.refresh();
							hideSpinner();
						}, 0);
					});
					$('#up_arrow').show();
				});
			}
		}
	}
	
	// display/hide the photos single photo page
	function photoClicked(chosenphoto) {
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#photos_single_photo_page').is(':visible')) {
				upArrowClicked();
			} else {
				showSpinner();
				$('.hidden:visible').slideUp('slow');
				// clear the photo page
				$('#photos_photo_holder').html('');
				$('#photo_tagged_bar').html('');
				$('#photo_drinks_holder').html('');
				$('#photo_drinks_tags_ul').html('');
				$('#photo_beers_holder').html('');
				$('#photo_beers_tags_ul').html('');
				
				// set the chosen photo to pass off to database function
				localStorage.setItem("chosenphoto", chosenphoto)
				
				// open the DB and fill in everything
				db.transaction(querySinglePhotoDB, errorCB, function(){});
				$('#photos_single_photo_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
						hideSpinner();
					}, 1000);
				});
				$('#up_arrow').show();
			}				
		}
	}
	
	// get the ajax and query the database to get the photo page information
	function querySinglePhotoDB(tx) {
		var selectedphoto = localStorage.getItem("chosenphoto");
		$.ajaxSetup({async: false});
		$.get("http://nationwidebarcrawl.com/mobilenative/photos/pk/" + selectedphoto + '/', function(response) {
			var parsed_data = $.parseJSON(response);
		
			// add photo to template
			$('#photos_photo_holder').append('<img src="http://nationwidebarcrawl.com' + parsed_data['imageurl'] + '" />');

			// add tagged bar to template
			var taggedbar = parsed_data['taggedbar'];
			if (taggedbar['name'] != null && taggedbar['name'] != "undefined") {
				$('#photo_tagged_bar').append('<div class="mobile_hr"></div><p>Bar Tag: <a href="#" onClick="singleBarClicked(\'' + taggedbar['pk'] + '\')">' + taggedbar['name'] + '</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#" onClick="removeBarTag(\'' + selectedphoto + '\')"><img src="./images/mobile/deleteicon.gif" /></a></p>');
			} else {
				$('#photo_tagged_bar').append('<div class="mobile_hr"></div><p><a href="#" onClick="showPhotoBarTagStatesPage()">Tag a Bar!</a></p>');
			}

			// add tagged beers to template
			if(parsed_data['beerstags'].length > 0) {
				var beertagsstring = '(';
				$.each(parsed_data['beerstags'], function() {
					beertagsstring += this['beerpk'] + ',';
				});
				// remove last comma from string
				beertagsstring = beertagsstring.slice(0,beertagsstring.length-1);
				// add final right parenthesis to string
				beertagsstring += ')';
				$('#photo_beers_holder').append('<div class="mobile_hr"></div><p>Beer Tags:</p>');
				SINGLEPHOTOBEERPKS = beertagsstring;
				// get filesystem access for beer images
				window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSinglePhotoBeerFSSuccess, errorHandler);
			} else {
				$('#photo_beers_holder').append('<div class="mobile_hr"></div><p><a href="./phototagbeer.html" rel="external">Tag a Beer!</a></p>');
			}

			// add tagged drinks to template
			if(parsed_data['drinkstags'].length > 0) {
				var drinktagsstring = '(';
				$.each(parsed_data['drinkstags'], function() {
					drinktagsstring += this['drinkpk'] + ',';
				});
				// remove last comma from string
				drinktagsstring = drinktagsstring.slice(0,drinktagsstring.length-1);
				// add final right parenthesis to string
				drinktagsstring += ')';
				$('#photo_drinks_holder').append('<div class="mobile_hr"></div><p>Drink Tags:</p>');
				SINGLEPHOTODRINKPKS = drinktagsstring;
				// get filesystem access for drink images
				window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSinglePhotoDrinkFSSuccess, errorHandler);
			} else {
				$('#photo_drinks_holder').append('<div class="mobile_hr"></div><p><a href="./phototagdrink.html" rel="external">Tag a Drink!</a></p>');
			}
		});
	}

	// got filesystem access for beer images
	function onSinglePhotoBeerFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/beers",{create:true},gotSinglePhotoBeersDir,onError);
	}

	// got filesystem access for drink images
	function onSinglePhotoDrinkFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/drinks",{create:true},gotSinglePhotoDrinksDir,onError);
	}

	// got filesystem directory for beer images
	function gotSinglePhotoBeersDir(d){
		SINGLEPHOTOBEERSDATADIR = d;
		// query the database to get beer image names
		var db = window.openDatabase("BEERSDBV4", "1.0", "Beers Database", 500000);
		db.transaction(querySinglePhotoBeersDB, errorCB, function(){});
	}

	// got filesystem directory for drink images
	function gotSinglePhotoDrinksDir(d) {
		SINGLEPHOTODRINKSDATADIR = d;
		// query the database to get drink image names
		var db = window.openDatabase("BEERSDBV4", "1.0", "Beers Database", 500000);
		db.transaction(querySinglePhotoDrinksDB, errorCB, function(){});
	}

	// Query the beers database
	function querySinglePhotoBeersDB(tx) {
	    tx.executeSql('SELECT * FROM beers WHERE id IN ' + SINGLEPHOTOBEERPKS, [], querySinglePhotoBeersSuccess, errorCB);
	}

	// Query the drinks database
	function querySinglePhotoDrinksDB(tx) {
		tx.executeSql('SELECT * FROM drinks WHERE id IN ' + SINGLEPHOTODRINKPKS, [], querySinglePhotoDrinksSuccess, errorCB);
	}

	// beers database query success callback
	function querySinglePhotoBeersSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			addSinglePhotoTaggedBeer(beer.imagename, beer.imageurl, beer.id);
		}
	}

	// drinks database query success callback
	function querySinglePhotoDrinksSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			addSinglePhotoTaggedDrink(drink.imagename, drink.imageurl, drink.id);
		}
	}

	// add a beer to the template
	function addSinglePhotoTaggedBeer(imagename, imageurl, id) {
		// get beer files
		SINGLEPHOTOBEERSDATADIR.getFile(imagename, {create: false}, function(file){gotSinglePhotoBeerFile(file, id);},function(){noSinglePhotoBeerFile(imageurl, id);});
	}

	// add a drink to the template
	function addSinglePhotoTaggedDrink(imagename, imageurl, id) {
		// get drink files
		SINGLEPHOTODRINKSDATADIR.getFile(imagename, {create: false}, function(file){gotSinglePhotoDrinkFile(file, id);},function(){noSinglePhotoDrinkFile(imageurl, id);});
	}

	// add a beer to the tagged beer list in the template
	function gotSinglePhotoBeerFile(fileEntry, id) {
		$('#photo_beers_tags_ul').append('<li><img src="' + fileEntry.fullPath + '" /><p><a href="#" onClick="removeBeerTag(\'' + id + '\', \'' + localStorage.getItem("chosenphoto") + '\')"><img src="./images/mobile/deleteicon.gif" /></a></p></li>');
	}

	// add a drink to the tagged drink list in the template
	function gotSinglePhotoDrinkFile(fileEntry, id) {
		$('#photo_drinks_tags_ul').append('<li><img src="' + fileEntry.fullPath + '" /><p><a href="#" onClick="removeDrinkTag(\'' + id + '\', \'' + + localStorage.getItem("chosenphoto") + '\')"><img src="./images/mobile/deleteicon.gif" /></a></p></li>');
	}

	// get thumbnail for a beer
	function noSinglePhotoBeerFile(imageurl, id) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = SINGLEPHOTOBEERSDATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(fileEntry) {$('#photo_beers_tags_ul').append('<li><img src="' + fileEntry.fullPath + '" /><p><a href="#" onClick="removeBeerTag(\'' + id + '\', \'' + localStorage.getItem("chosenphoto") + '\')"><img src="./images/mobile/deleteicon.gif" /></a></p></li>');}, null);
	}

	// get thumbnail for a drink
	function noSinglePhotoDrinkFile(imageurl, id) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = SINGLEPHOTODRINKSDATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(fileEntry) {$('#photo_drinks_tags_ul').append('<li><img src="' + fileEntry.fullPath + '" /><p><a href="#" onClick="removeDrinkTag(\'' + id + '\', \'' + localStorage.getItem("chosenphoto") + '\')"><img src="./images/mobile/deleteicon.gif" /></a></p></li>');}, null);
	}
	
	// display states list for PhotoBarTag
	function showPhotoBarTagStatesPage() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#photo_bar_tag_states_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the states list
			$('#photo_bar_tag_states_ul').html('');
			$.get("http://nationwidebarcrawl.com/mobilenative/destinationstatelist/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					var chosenstate = this['state'] + '';
					$('#photo_bar_tag_states_ul').append('<li><a href="#" onClick="showPhotoBarTagStatePage(\'' + chosenstate + '\')">' + this['name'] + '</a><span class="native_ul_arrow"></span></li>');
				});
				$('#photo_bar_tag_states_page').slideDown('slow', function() {
					setTimeout(function() {
						hideSpinner();
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}

	// display/hide the state page to create a photo bar tag
	function showPhotoBarTagStatePage(selectedstate) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			// set chosen state
			window.localStorage.setItem("chosenstate", selectedstate);
			$('.hidden:visible').slideUp('slow');
			// clear bar state list
			$('#photo_bar_tag_state_ul').html('');
			showSpinner();
			// variable for when bars db has been created
			var barsDbs = localStorage.getItem("barsDbs");
			barsDbs = String(barsDbs);
			// check if barsDbs is empty
			if (barsDbs && barsDbs != "") {
				if (barsDbs.search(selectedstate)!=-1) {
					db.transaction(queryPhotoBarTagStateDB, errorCB, function(){});
				} else {
					db.transaction(populateBarsStateDB, errorCB, successPhotoBarTagStateCB);
				}
			} else {
				db.transaction(populateBarsStateDB, errorCB, successPhotoBarTagStateCB);
			}
		}
	}
	
	// Bar State DB Success Callback
	function successPhotoBarTagStateCB() {
		db.transaction(queryPhotoBarTagStateDB, errorCB);
	}
	
	// Query the database for bars for bar state list in bars button
	function queryPhotoBarTagStateDB(tx) {
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('SELECT DISTINCT destination, city FROM bars WHERE statekey = ?', [selectedstate], queryPhotoBarTagStateSuccess, errorCB);
	}
	
	// Bar State DB Query Success Callback
	function queryPhotoBarTagStateSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#photo_bar_tag_state_ul').append('<li><a href="#" onClick="showPhotoBarTagDestList(\'' + bar.destination + '\')">' + bar.destination + ' - ' + bar.city + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the bar state page
		$('#photo_bar_tag_state_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	
	// display/hide the bar list for the chosen destination for creating a Photo Bar Tag
	function showPhotoBarTagDestList(selecteddest) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#photo_bar_tag_destination_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// set the selected destination
			window.localStorage.setItem("chosendest", selecteddest);
			// clear the bar dest list
			$('#photo_bar_tag_bars_ul').html('');
			showSpinner();
			db.transaction(queryPhotoBarTagDestListDB, errorCB, function(){});
		}
	}
	
	// Query the database for the bars list for selected destination
	function queryPhotoBarTagDestListDB(tx) {
		var selecteddest = window.localStorage.getItem("chosendest");
		tx.executeSql('SELECT name, id FROM bars WHERE destination = ?', [selecteddest], queryPhotoBarTagDestListSuccess, errorCB);
	}
	
	// Bars List Query Success Callback for bars button
	function queryPhotoBarTagDestListSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#photo_bar_tag_bars_ul').append('<li><a href="#" onClick="PhotoBarTagBarClicked(\'' + bar.id + '\')">' + bar.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the bar destination page
		$('#photo_bar_tag_destination_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	
	// display/hide the single bar page
	function PhotoBarTagBarClicked(selectedbar) {
		if ($('#single_bar_page').is(':visible')) {
			upArrowClicked();
		} else {
			// set selected bar for retreival later
			window.localStorage.setItem("chosenbar", selectedbar);
			showSpinner();
			$('.hidden:visible').slideUp('slow');	
			photopk = window.localStorage.getItem("chosenphoto");
			$.get('http://nationwidebarcrawl.com/mobilenative/photos/addbartag/' + photopk + '/' + selectedbar + '/', function() { 
				window.location.href="index.html";
			});
		}
	}
	
	// remove a bar tag from a photo
	function removeBarTag(chosenphoto) {
		showSpinner();
		// GET to remove bar tag from chosen photo
		$.get("http://nationwidebarcrawl.com/mobilenative/photos/removebartag/" + chosenphoto + "/", function(response) {
			hideSpinner();
			// reload the photo page
       		photoClicked(chosenphoto);
		});
	}
	
	// remove a beer tag from a photo
	function removeBeerTag(chosenbeer, chosenphoto) {
		showSpinner();
		// GET to remove beer tag from chosen photo
		$.get("http://nationwidebarcrawl.com/mobilenative/photos/removebeertag/" + chosenphoto + "/" + chosenbeer + "/", function(response) {
			hideSpinner();
			// reload the photo page
        	photoClicked(chosenphoto);
		});
	}
	
	// remove a drink tag from a photo
	function removeDrinkTag(chosendrink, chosenphoto) {
		showSpinner();
		// GET to remove beer tag from chosen photo
		$.get("http://nationwidebarcrawl.com/mobilenative/photos/removedrinktag/" + chosenphoto + "/" + chosendrink + "/", function(response) {
			hideSpinner();
			// redirect to photo page
			photoClicked(chosenphoto);
		});
	}
	
	// display/hide the photos take photo page
	function showTakePhotoPage() {
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#photos_take_photo_page').is(':visible')) {
				upArrowClicked();
			} else {
				$('.hidden:visible').slideUp('slow');
				$('#photos_take_photo_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			}
		}
	}
	
	// function to pop the camera for a new photo
	function photosNewCameraPhoto() {
		navigator.camera.getPicture(captureSuccess, captureError, {sourceType: Camera.PictureSourceType.CAMERA, destinationType: Camera.DestinationType.FILE_URI});
	}
	
	// function to pop the gallery for a new photo
	function photosNewGalleryPhoto() {
		navigator.camera.getPicture(captureSuccess, captureError, {sourceType: Camera.PictureSourceType.PHOTOLIBRARY, destinationType: Camera.DestinationType.FILE_URI});
	}

	// picture successfully captured, get link to file on filesystem
	function captureSuccess(mediaFiles) {
		window.resolveLocalFileSystemURI(mediaFiles, gotFilePath, null);
	}

	// got filesystem link for photo, upload to web server
	function gotFilePath(fileEntry) {
		showSpinner();
		var options = new FileUploadOptions();
		options.fileKey="image";
		options.chunkedMode=false;
		var ft = new FileTransfer();
		ft.upload(fileEntry.fullPath, 'http://nationwidebarcrawl.com/mobilenative/photos/upload/', uploadSuccess, uploadFail, options);
	}

	// picture uploaded successfully
	function uploadSuccess() {
		alert('Picture uploaded!');
		hideSpinner();
		showPhotosPage();
	}

	// upload error
	function uploadFail(error) {
		alert('Sorry, there was an error uploading your photo, please try again.');
		hideSpinner();
		upArrowClicked();
	}

	// error capturing the photo
	function captureError(error) {
		alert('Sorry, there was an error capturing your photo, please try again.');
		hideSpinner();
	}
	
	//************************************************************
	//
	// WEEKLY POLL
	//
	//************************************************************
	
	// display/hide the weekly poll page
	function showWeeklyPoll(chosengallery) {
		if ($('#weekly_poll_page').is(':visible')) {
			upArrowClicked();
		} else {
			showSpinner();
			$('.hidden:visible').slideUp('slow');
			// clear the poll page
			$('#weekly_poll_page').html('');
			// fill in the polls
			$.get("http://nationwidebarcrawl.com/mobilenative/weekly-polls/", function(response) {
            	var parsed_data = $.parseJSON(response);
                $.each(parsed_data, function() {
                	$('#weekly_poll_page').append('<p class="weekly_poll_name">' + this['name'] + '</p><div class="weekly_poll_holder"><div class="weekly_poll_left"><img src="http://nationwidebarcrawl.com' + this['beer1image'] + '" /><p><a href="#" onClick="voteButtonClicked(' + this['pollpk' ] + ', ' + this['beer1pk'] + ')"><img src="./images/mobile/vote.png" /></a></p><p>Votes: ' + this['beer1counter'] + '</p></div><div class="weekly_poll_right"><img src="http://nationwidebarcrawl.com' + this['beer2image'] + '" /><p><a href="#" onClick="voteButtonClicked(' + this['pollpk' ] + ', ' + this['beer2pk'] + ')"><img src="./images/mobile/vote.png" /></a></p><p>Votes: ' + this['beer2counter'] + '</p></div><p class="weekly_poll_vs">VS.</p></div><div class="mobile_hr"></div>');
                });
				$('#weekly_poll_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
						hideSpinner();
					}, 0);
				});
				$('#up_arrow').show();
            });
		}
	}
	
	// vote function for a beer on the weekly poll page
	function voteButtonClicked(chosenpollpk, chosenbeerpk) {
		showSpinner();
		$.post("http://nationwidebarcrawl.com/mobilenative/weekly-polls/", { pollpk: chosenpollpk, beerpk: chosenbeerpk }, function(response) {
			var parsed_data = $.parseJSON(response);
			hideSpinner();
			// if not logged in, show log in page
			if (parsed_data[0].status == "0") {
				alert("Please login to vote");
				loginPageClicked();
			}
			// if error, display message
			if (parsed_data[0].message != undefined) {
				alert(parsed_data[0].message);
			} else {
				// clear the poll page
				$('#weekly_poll_page').html('');
				// reload the poll page with updated vote numbers
				$.each(parsed_data, function() {
                	$('#weekly_poll_page').append('<p class="weekly_poll_name">' + this['name'] + '</p><div class="weekly_poll_holder"><div class="weekly_poll_left"><img src="http://nationwidebarcrawl.com' + this['beer1image'] + '" /><p><a href="#" onClick="voteButtonClicked(' + this['pollpk' ] + ', ' + this['beer1pk'] + ')"><img src="./images/mobile/vote.png" /></a></p><p>Votes: ' + this['beer1counter'] + '</p></div><div class="weekly_poll_right"><img src="http://nationwidebarcrawl.com' + this['beer2image'] + '" /><p><a href="#" onClick="voteButtonClicked(' + this['pollpk' ] + ', ' + this['beer2pk'] + ')"><img src="./images/mobile/vote.png" /></a></p><p>Votes: ' + this['beer2counter'] + '</p></div><p class="weekly_poll_vs">VS.</p></div><div class="mobile_hr"></div>');
                });
			}
		});
	}
	
	//************************************************************
	//
	// DRINKING BUDDIES
	//
	//************************************************************
	
	// display/hide the drinking buddies page
	function showDrinkingBuddies() {
		// check for login status here
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#drinking_buddies_page').is(':visible')) {
				upArrowClicked();
			} else {
				showSpinner();
				$('.hidden:visible').slideUp('slow');
				// clear the drinking buddies page
				$('#drinking_buddies_ul').html('');
				// fill in the buddies list
				$.get("http://nationwidebarcrawl.com/mobilenative/buddies/", function(response) {
   		         	var parsed_data = $.parseJSON(response);
   	    	        $.each(parsed_data, function() {
           		    	$('#drinking_buddies_ul').append('<li><a href="#" onClick="profileUserClicked(' + this['friendpk'] + ')"><img src="http://nationwidebarcrawl.com/mobilenative/profile/avatar/' + this['friend'] + '/" /><p>' + this['friend'] + '</p></a></li>');
                	});
					$('#drinking_buddies_page').slideDown('slow', function() {
						setTimeout(function() {
							myScroll.refresh();
							hideSpinner();
						}, 1000);
					});
					$('#up_arrow').show();
         	    });
            }
		}
	}
	
	// create a new friendship request
	function friendRequestNewClicked(selecteduser) {
		showSpinner();
		$.get("http://nationwidebarcrawl.com/mobilenative/friendrequest/" + selecteduser + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			if (parsed_data['status'] == 1) {
				$('#profile_member1_buddy_button').html('<p>Buddy Request Pending</p>');
			}
			hideSpinner();
		});
	}
	
	//************************************************************
	//
	// PROFILE
	//
	//************************************************************
	
	// function to view a users own profile
	function profileClicked() {
		// check for login status here
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			// display the profile page
			if ($('#profile_page').is(':visible')) {
				upArrowClicked();
			} else {
				showSpinner();
				// get the profile data from the server, append to the template, pass the favoritebeer and favoritedrink pks along for filesystem access
				$.get("http://nationwidebarcrawl.com/mobilenative/profile/", function(response) {
					// clear the profile divs for when profile is loaded more than once
					$('#profile_name').html('');
					$('#profile_score_main').html('');
					$('#profile_info').html('');
					$('#profile_image_holder').html('');
					$('#beer_score').html('');
					$('#drink_score').html('');
					$('#total_score').html('');
					$('#mobile_profile_beers_ul').html('');
					$('#mobile_profile_drinks_ul').html('');
					// fill in values
					var parsed_data = $.parseJSON(response);
					$('#profile_name').append(parsed_data['username']);
					$('#profile_score_main').append('Member Score: <br />' + parsed_data['memberscore']);
					// set link to display favorite beer or pick favorite beer if not already set
					if (parsed_data['favbeerpk'] != null) {
						var favbeerlink = '<a href="#" onClick="singleBeerClicked(\'' + parsed_data['favbeerpk'] + '\')">';
					} else {
						var favbeerlink = '<a href="./profilechangebeer.html">';
					}
					// set link to display favorite drink or pick favorite drink if not already set
					if (parsed_data['favdrinkpk'] != null) {
						var favdrinklink = '<a href="#" onClick="singleDrinkClicked(\'' + parsed_data['favdrinkpk'] + '\')">';
					} else {
						var favdrinklink = '<a href="#" onClick="profileChangeFavoriteDrinkClicked()">';
					}
					// set link to display favorite bar or pick favorite bar if not already set
					if (parsed_data['favbarpk'] != null) {
						var favbarlink = '<a href="#" onClick="singleBarClicked(\'' + parsed_data['favbarpk'] + '\')">';
					} else {
						var favbarlink = '<a href="./profilechangebarstate.html">';
					}
					$('#profile_info').append('<p>Destination: <a href="#" onClick="showBarDestList(\'' + parsed_data['favdest'] + '\')">' + parsed_data['favdest'] + '</a></p><p>Favorite Beer: ' + favbeerlink + parsed_data['favbeer'] + '</a></p><p>Favorite Drink: ' + favdrinklink + parsed_data['favdrink'] + '</a></p><p>Favorite Bar: ' + favbarlink + parsed_data['favbar'] + '</a></p>');
					$('#profile_image_holder').append('<a href="#" onClick="profileChangeImageClicked()"><img id="profile_user_avatar" src="http://nationwidebarcrawl.com' + parsed_data['image'] + '" /></a>');
					$('#beer_score').append(parsed_data['beerscore']);
					$('#drink_score').append(parsed_data['drinkscore']);
					$('#total_score').append(parsed_data['memberscore']);
					fillInProfile(parsed_data['favbeers'], parsed_data['favdrinks']);
					// get photos for profile page
					showProfileGalleries();
					$('.hidden:visible').slideUp('slow');
					$('#profile_page').slideDown('slow', function() {
						setTimeout(function() {
							myScroll.refresh();
							hideSpinner();
						}, 500);
					});
					$('#up_arrow').show();
				});
			}
		}
	}

	// function to view a profile of a random user
	function profileUserClicked(clickedbuddypk) {
		// check for login status here
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			// display the profile page
			if ($('#profile_member1_page').is(':visible')) {
				upArrowClicked();
			}
			showSpinner();
			// get the profile data from the server, append to the template, pass the favoritebeer and favoritedrink pks along for filesystem access
			$.post("http://nationwidebarcrawl.com/mobilenative/profileuser/", { buddypk: clickedbuddypk }, function(response) {
				// clear the profile divs for when profile is loaded more than once
				$('#profile_member1_name').html('');
				$('#profile_member1_buddy_button').html('');
				$('#profile_member1_score_main').html('');
				$('#profile_member1_info').html('');
				$('#profile_member1_image_holder').html('');
				$('#profile_member1_beer_score').html('');
				$('#profile_member1_drink_score').html('');
				$('#profile_member1_total_score').html('');
				$('#profile_member1_beers_ul').html('');
				$('#profile_member1_drinks_ul').html('');
				// fill in values
				var parsed_data = $.parseJSON(response);
				$('#profile_member1_name').append(parsed_data['username']);
				if (parsed_data['isBuddy'] != true) {
					$('#profile_member1_buddy_button').append('<a href="#" onClick="friendRequestNewClicked(\'' + parsed_data['username'] + '\')">Add Buddy Button Here');
				}
				if (parsed_data['isBuddyRequesting'] == true) {
					$('#profile_member1_buddy_button').html('<a href="#" onClick="">Accept Friend Request Button Here</a>');
				}
				$('#profile_member1_score_main').append('Member Score: <br />' + parsed_data['memberscore']);
				// set link to display favorite drink or pick favorite drink if not already set
				var favdrinklink = '<a>';
				if (parsed_data['favdrinkpk'] != null) {
					var favdrinklink = '';
				}
				$('#profile_member1_info').append('<p>Destination: <a href="#" onClick="showBarDestList(\'' + parsed_data['favdest'] + '\')">' + parsed_data['favdest'] + '</a></p>');
				if (parsed_data['favbeerpk'] != null) {
					$('#profile_member1_info').append('<p>Favorite Beer: <a href="#" onClick="singleBeerClicked(\'' + parsed_data['favbeerpk'] + '\')">' + parsed_data['favbeer'] + '</a></p>');
				}
				if (parsed_data['favdrinkpk'] != null) {
					$('#profile_member1_info').append('<p>Favorite Drink: <a href="#" onClick="singleDrinkClicked(\'' + parsed_data['favdrinkpk'] + '\')">' + parsed_data['favdrink'] + '</a></p>');
				}
				$('#profile_member1_info').append('<p>Favorite Bar: <a href="#" onClick="singleBarClicked(\'' + parsed_data['favbarpk'] + '\')">' + parsed_data['favbar'] + '</a></p>');
				$('#profile_member1_image_holder').append('<img id="profile_user_avatar" src="http://nationwidebarcrawl.com' + parsed_data['image'] + '" />');
				$('#profile_member1_beer_score').append(parsed_data['beerscore']);
				$('#profile_member1_drink_score').append(parsed_data['drinkscore']);
				$('#profile_member1_total_score').append(parsed_data['memberscore']);
				fillInMember1Profile(parsed_data['favbeers'], parsed_data['favdrinks']);
				$('.hidden:visible').slideUp('slow');
				$('#profile_member1_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
						hideSpinner();
					}, 500);
				});
				$('#up_arrow').show();
			});
		}
	}

	// Query the success callback
	function fillInProfile(favbeerpks, favdrinkpks) {
		// get users top 5 beers
		var beertagsstring = '(' + favbeerpks;
		// remove last comma from string
		beertagsstring = beertagsstring.slice(0,beertagsstring.length-1);
		// add final right parenthesis to string
		beertagsstring += ')';
		BEERPKS = beertagsstring;
	
		// if there are beers, add them to the template
		if(BEERPKS != ")") {
			// get filesystem access for beer images
			window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onBeerFSSuccess, errorHandler);
		}
	
		// fill in empty beers if beers count is less than 5
		if (BEERPKS.split(/,/g).length - 1 < 5) {
			var x = 0;
			if (BEERPKS == ")"){
				x=0;
			} else {
				x=BEERPKS.split(/,/g).length;
			}
			for (x; x<5; x++) {
				$('#mobile_profile_beers_ul').append('<li><a href="#" onClick="profileChangeFavorite5BeersClicked()"><img src="./images/mobile/BeerEmpty.png" /></a></li>');
			}
		}
		
		// get users top 3 drinks
		var drinktagsstring = '(' + favdrinkpks;
		// remove last comma from string
		drinktagsstring = drinktagsstring.slice(0,drinktagsstring.length-1);
		// add final right parenthesis to string
		drinktagsstring += ')';
		DRINKPKS = drinktagsstring;
	
		// if favorite drinks, add them to template
		if(DRINKPKS != ")") {
			// get filesystem access for beer images
			window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onDrinkFSSuccess, errorHandler);
		}
		// fill in empty drinks if drinks count is less than 3
		if (DRINKPKS.split(/,/g).length - 1 < 3) {
			var y = 0;
			if (DRINKPKS == ")"){
				y=0;
			} else {
				y=DRINKPKS.split(/,/g).length;
			}
			for (y; y<3; y++) {
				$('#mobile_profile_drinks_ul').append('<li><a href="#" onClick="profileChangeFavorite5DrinksClicked()"><img src="./images/mobile/DrinkEmpty.png" /></a></li>');
			}
		}
	}

	// got filesystem access for beer images
	function onBeerFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/beers",{create:true},gotBeersDir,onError);
	}

	// got filesystem access for drink images
	function onDrinkFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/drinks",{create:true},gotDrinksDir,onError);
	}

	// got filesystem directory for beer images
	function gotBeersDir(d){
		BEERSDATADIR = d;
		// query the database to get beer image names
		db.transaction(queryBeersDB, errorCB, function(){});
	}

	// got filesystem directory for drink images
	function gotDrinksDir(d){
		DRINKSDATADIR = d;
		// query the database to get drink image names
		db.transaction(queryDrinksDB, errorCB, function(){});
	}

	// Query the beers database
	function queryBeersDB(tx) {
		tx.executeSql('SELECT * FROM beers WHERE id IN ' + BEERPKS, [], queryBeersSuccess, errorCB);
	}

	// Query the drinks database
	function queryDrinksDB(tx) {
		tx.executeSql('SELECT * FROM drinks WHERE id IN ' + DRINKPKS, [], queryDrinksSuccess, errorCB);
	}

	// beers database query success callback
	function queryBeersSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			addFavoriteBeer(beer.imagename, beer.imageurl, beer.id);
		}
	}

	// drinks database query success callback
	function queryDrinksSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			addFavoriteDrink(drink.imagename, drink.imageurl, drink.id);
		}
	}

	// add a beer to the template
	function addFavoriteBeer(imagename, imageurl, id) {
		// get beer files
		BEERSDATADIR.getFile(imagename, {create: false}, gotBeerFile,function(){noBeerFile(imageurl);});
	}

	// add a drink to the template
	function addFavoriteDrink(imagename, imageurl, id) {
		// get drink files
		DRINKSDATADIR.getFile(imagename, {create: false},function(fileEntry){gotDrinkFile(fileEntry, id);},function(){noDrinkFile(imageurl);});
	}

	// add a beer to the favorite beer list in the template
	function gotBeerFile(fileEntry, id) {
		$('#mobile_profile_beers_ul').append('<li><img src="' + fileEntry.fullPath + '" /></li>');
	}

	// add a drink to the favorite drink list in the template
	function gotDrinkFile(fileEntry, id) {
		$('#mobile_profile_drinks_ul').append('<li><a href="#" onClick="singleDrinkClicked(' + id + ')"><img src="' + fileEntry.fullPath + '" /></a></li>');
	}

	// get thumbnail for a beer
	function noBeerFile(imageurl) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = BEERSDATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(fileEntry) {$('#mobile_profile_beers_ul').append('<li><img src="' + fileEntry.fullPath + '" /></li>');}, null);
	}

	// get thumbnail for a drink
	function noDrinkFile(imageurl) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DRINKSDATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(fileEntry) {$('#mobile_profile_drinks_ul').append('<li><img src="' + fileEntry.fullPath + '" /></li>');}, null);
	}
	
	// display/hide the photos section on the profile page
	function showProfileGalleries() {
		// clear the galleries
		$('#profile_galleries_ul').html('');
		// fill in the galleries ul
		$.get("http://nationwidebarcrawl.com/mobilenative/photos/", function(response) {
			var parsed_data = $.parseJSON(response);
			$.each(parsed_data, function() {
				var chosengallery = this['gallerypk'];
				$('#profile_galleries_ul').append('<li class="mobile_left"><a href="#" rel="external" onClick="galleryClicked(\'' + chosengallery + '\')"><img src="http://nationwidebarcrawl.com' + this['73x71'] + '" /></a><p>' + this['name'] + '</p></li>');
			});
		});
	}
	
	// Query the success callback
	function fillInMember1Profile(favbeerpks, favdrinkpks) {
		// get users top 5 beers
		var beertagsstring = '(' + favbeerpks;
		// remove last comma from string
		beertagsstring = beertagsstring.slice(0,beertagsstring.length-1);
		// add final right parenthesis to string
		beertagsstring += ')';
		BEERPKS = beertagsstring;
	
		// if there are beers, add them to the template
		if(BEERPKS != ")") {
			// get filesystem access for beer images
			window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onBeerMember1FSSuccess, errorHandler);
		}
	
		// fill in empty beers if beers count is less than 5
		if (BEERPKS.split(/,/g).length - 1 < 5) {
			var x = 0;
			if (BEERPKS == ")"){
				x=0;
			} else {
				x=BEERPKS.split(/,/g).length;
			}
			for (x; x<5; x++) {
				$('#profile_member1_beers_ul').append('<li><img src="./images/mobile/BeerEmpty.png" /></li>');
			}
		}
		
		// get users top 3 drinks
		var drinktagsstring = '(' + favdrinkpks;
		// remove last comma from string
		drinktagsstring = drinktagsstring.slice(0,drinktagsstring.length-1);
		// add final right parenthesis to string
		drinktagsstring += ')';
		DRINKPKS = drinktagsstring;
	
		// if favorite drinks, add them to template
		if(DRINKPKS != ")") {
			// get filesystem access for beer images
			window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onDrinkMember1FSSuccess, errorHandler);
		}
		// fill in empty drinks if drinks count is less than 3
		if (DRINKPKS.split(/,/g).length - 1 < 3) {
			var y = 0;
			if (DRINKPKS == ")"){
				y=0;
			} else {
				y=DRINKPKS.split(/,/g).length;
			}
			for (y; y<3; y++) {
				$('#profile_member1_drinks_ul').append('<li><img src="./images/mobile/DrinkEmpty.png" /></li>');
			}
		}
	}
	
	// got filesystem access for beer images
	function onBeerMember1FSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/beers",{create:true},gotBeersMember1Dir,onError);
	}
	
	// got filesystem access for drink images
	function onDrinkMember1FSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/drinks",{create:true},gotDrinksMember1Dir,onError);
	}
	
	// got filesystem directory for drink images
	function gotDrinksMember1Dir(d){
		DRINKSDATADIR = d;
		// query the database to get drink image names
		db.transaction(queryDrinksMember1DB, errorCB, function(){});
	}
	
	// Query the drinks database
	function queryDrinksMember1DB(tx) {
		tx.executeSql('SELECT * FROM drinks WHERE id IN ' + DRINKPKS, [], queryDrinksMember1Success, errorCB);
	}
	
	// drinks database query success callback
	function queryDrinksMember1Success(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			addFavoriteMember1Drink(drink.imagename, drink.imageurl, drink.id);
		}
	}
	
	// add a drink to the template for the member1 profile
	function addFavoriteMember1Drink(imagename, imageurl, id) {
		// get drink files
		DRINKSDATADIR.getFile(imagename, {create: false},function(fileEntry){gotMember1DrinkFile(fileEntry, id);},function(){noMember1DrinkFile(imageurl);});
	}
	
	// get thumbnail for a drink
	function noMember1DrinkFile(imageurl) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DRINKSDATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(fileEntry) {$('#profile_member1_drinks_ul').append('<li><img src="' + fileEntry.fullPath + '" /></li>');}, null);
	}
	
	// add a drink to the favorite drink list in the template
	function gotMember1DrinkFile(fileEntry, id) {
		$('#profile_member1_drinks_ul').append('<li><a href="#" onClick="singleDrinkClicked(' + id + ')"><img src="' + fileEntry.fullPath + '" /></a></li>');
	}
	
	// got filesystem directory for beer images
	function gotBeersMember1Dir(d){
		BEERSDATADIR = d;
		// query the database to get beer image names
		db.transaction(queryBeersMember1DB, errorCB, function(){});
	}
	
	// Query the beers database
	function queryBeersMember1DB(tx) {
		tx.executeSql('SELECT * FROM beers WHERE id IN ' + BEERPKS, [], queryBeersMember1Success, errorCB);
	}
	
	// beers database query success callback
	function queryBeersMember1Success(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			addFavoriteMember1Beer(beer.imagename, beer.imageurl, beer.id);
		}
	}
	
	// add a beer to the template for the Member1 profile page
	function addFavoriteMember1Beer(imagename, imageurl, id) {
		// get beer files
		BEERSDATADIR.getFile(imagename, {create: false}, gotBeerMember1File,function(){noBeerMember1File(imageurl);});
	}
	
	// add a beer to the favorite beer list in the template
	function gotBeerMember1File(fileEntry, id) {
		$('#profile_member1_beers_ul').append('<li><img src="' + fileEntry.fullPath + '" /></li>');
	}
		
	// get thumbnail for a beer
	function noBeerMember1File(imageurl) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = BEERSDATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(fileEntry) {$('#profile_member1_beers_ul').append('<li><img src="' + fileEntry.fullPath + '" /></li>');}, null);
	}
	
	// display/hide the edit profile page
	function showProfileEditPage() {
		if ($('#profile_edit_page').is(':visible')) {
			upArrowClicked();
		} else {
			showSpinner();
			$('.hidden:visible').slideUp('slow');
			// clear the drinking buddies page
			$('#profile_edit_info').html('');
			// get the profile data from the server, append to the template, pass the favoritebeer and favoritedrink pks along for filesystem access
			$.get("http://nationwidebarcrawl.com/mobilenative/profile/", function(response) {
				var parsed_data = $.parseJSON(response);
				// set link to display favorite beer or pick favorite beer if not already set
				if (parsed_data['favbeerpk'] != null) {
					var favbeerlink = '<a href="#" onClick="singleBeerClicked(\'' + parsed_data['favbeerpk'] + '\')">';
				} else {
					var favbeerlink = '<a href="./profilechangebeer.html">';
				}
				// set link to display favorite drink or pick favorite drink if not already set
				if (parsed_data['favdrinkpk'] != null) {
					var favdrinklink = '<a href="#" onClick="singleDrinkClicked(\'' + parsed_data['favdrinkpk'] + '\')">';
				} else {
					var favdrinklink = '<a href="#" onClick="profileChangeFavoriteDrinkClicked()">';
				}
				$('#profile_edit_info').append('<p>Destination: <a href="#" onClick="destClicked(\'' + parsed_data['favdest'] + '\')">' + parsed_data['favdest'] + '</a></p><p><a href="#" onClick="profileChangeFavoriteDestinationClicked()">Change Destination</a></p>');
				$('#profile_edit_info').append('<p>Favorite Beer: ' + favbeerlink + parsed_data['favbeer'] + '</a></p><p><a href="#" onClick="profileChangeFavoriteBeerClicked()">Change Favorite Beer</a></p>');
				$('#profile_edit_info').append('<p>Favorite Drink: ' + favdrinklink + parsed_data['favdrink'] + '</a></p><p><a href="#" onClick="profileChangeFavoriteDrinkClicked()">Change Favorite Drink</a></p>');
				$('#profile_edit_info').append('<p>Favorite Bar: <a href="#" onClick="singleBarClicked(\'' + parsed_data['favbarpk'] + '\')">' + parsed_data['favbar'] + '</a></p><p><a href="#" onClick="profileChangeFavoriteBarClicked()">Change Favorite Bar</a></p>');
				// show the profile edit page
				$('#profile_edit_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
						hideSpinner();
					}, 0);
				});
				$('#up_arrow').show();
            });
		}
	}
	
	// show the state list for the profile change favorite destination page
	function profileChangeFavoriteDestinationClicked() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_states_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the states list
			$('#bar_states_list_ul').html('');
			// get the states list
			$.get("http://nationwidebarcrawl.com/mobilenative/destinationstatelist/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					var chosenstate = this['state'] + '';
					$('#bar_states_list_ul').append('<li><a href="#" onClick="profileShowFavDestBarState(\'' + chosenstate + '\')">' + this['name'] + '</a><span class="native_ul_arrow"></span></li>');
				});
				// add click event listener to highlight clicked li
				$('#specials ul li').click(function() {
					$(this).addClass('li_clicked');
				});
				// show the specials states page
				$('#bar_states_page').slideDown('slow', function() {
					setTimeout(function() {
						hideSpinner();
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	// display/hide the destination list for selectedstate for the profile favorite destination
	function profileShowFavDestBarState(selectedstate) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			// set chosen state
			window.localStorage.setItem("chosenstate", selectedstate);
			$('.hidden:visible').slideUp('slow');
			// clear bar state list
			$('#bar_state_list_ul').html('');
			showSpinner();
			// variable for when bars db has been created
			var barsDbs = localStorage.getItem("barsDbs");
			barsDbs = String(barsDbs);
			// check if barsDbs is empty
			if (barsDbs && barsDbs != "") {
				if (barsDbs.search(selectedstate)!=-1) {
					db.transaction(queryFavDestBarStateDB, errorCB, function(){});
				} else {
					db.transaction(populateBarsStateDB, errorCB, successBarStateCB);
				}
			} else {
				db.transaction(populateBarsStateDB, errorCB, successBarStateCB);
			}
		}
	}
	
	// Query the database for bars for bar state list in bars button
	function queryFavDestBarStateDB(tx) {
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('SELECT DISTINCT destination, city, destination_slug FROM bars WHERE statekey = ?', [selectedstate], queryFavDestBarStateSuccess, errorCB);
	}
	
	// Bar State DB Query Success Callback
	function queryFavDestBarStateSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#bar_state_list_ul').append('<li><a href="#" onClick="profileNewFavDest(\'' + bar.destination_slug + '\')">' + bar.destination + ' - ' + bar.city + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the bar state page
		$('#bar_state_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	
	// Set the favorite destination for a user
	function profileNewFavDest(chosendest) {
		if ($('#bar_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
		}
		showSpinner();
		// GET to change the users favorite destination
		$.get("http://nationwidebarcrawl.com/mobilenative/profile/setdest/" + chosendest + "/", function(response) {
		});
		profileClicked();
	}
	
	// show the state list for the profile change favorite bar page
	function profileChangeFavoriteBarClicked() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_states_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the states list
			$('#bar_states_list_ul').html('');
			// get the states list
			$.get("http://nationwidebarcrawl.com/mobilenative/destinationstatelist/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					var chosenstate = this['state'] + '';
					$('#bar_states_list_ul').append('<li><a href="#" onClick="profileShowFavBarState(\'' + chosenstate + '\')">' + this['name'] + '</a><span class="native_ul_arrow"></span></li>');
				});
				// add click event listener to highlight clicked li
				$('#specials ul li').click(function() {
					$(this).addClass('li_clicked');
				});
				// show the specials states page
				$('#bar_states_page').slideDown('slow', function() {
					setTimeout(function() {
						hideSpinner();
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	// display/hide the destination list for selectedstate for the profile favorite bar
	function profileShowFavBarState(selectedstate) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			// set chosen state
			window.localStorage.setItem("chosenstate", selectedstate);
			$('.hidden:visible').slideUp('slow');
			// clear bar state list
			$('#bar_state_list_ul').html('');
			showSpinner();
			// variable for when bars db has been created
			var barsDbs = localStorage.getItem("barsDbs");
			barsDbs = String(barsDbs);
			// check if barsDbs is empty
			if (barsDbs && barsDbs != "") {
				if (barsDbs.search(selectedstate)!=-1) {
					db.transaction(queryFavBarStateDB, errorCB, function(){});
				} else {
					db.transaction(populateBarsStateDB, errorCB, successBarStateCB);
				}
			} else {
				db.transaction(populateBarsStateDB, errorCB, successBarStateCB);
			}
		}
	}
	
	// Query the database for bars for bar state list in bars button
	function queryFavBarStateDB(tx) {
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('SELECT DISTINCT destination, city FROM bars WHERE statekey = ?', [selectedstate], queryFavBarStateSuccess, errorCB);
	}
	
	// Bar State DB Query Success Callback
	function queryFavBarStateSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#bar_state_list_ul').append('<li><a href="#" onClick="profileNewFavBarDest(\'' + bar.destination + '\')">' + bar.destination + ' - ' + bar.city + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the bar state page
		$('#bar_state_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	
	// display/hide the bar list for the chosen destination for profile set favorite bar
	function profileNewFavBarDest(selecteddest) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_dest_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// set the selected destination
			window.localStorage.setItem("chosendest", selecteddest);
			// clear the bar dest list
			$('#bar_dest_list_ul').html('');
			showSpinner();
			db.transaction(queryProfileFavoriteBarDestListDB, errorCB, function(){});
		}
	}
	
	// Query the database for the bars list for selected destination
	function queryProfileFavoriteBarDestListDB(tx) {
		var selecteddest = window.localStorage.getItem("chosendest");
		tx.executeSql('SELECT name, id FROM bars WHERE destination = ?', [selecteddest], queryProfileFavoriteBarDestListSuccess, errorCB);
	}
	
	// Bars List Query Success Callback for bars button
	function queryProfileFavoriteBarDestListSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#bar_dest_list_ul').append('<li><a href="#" onClick="profileFavoriteBarClicked(\'' + bar.id + '\')">' + bar.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the bar destination page
		$('#bar_dest_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	
	// Set the clicked bar as the profile favorite bar
	function profileFavoriteBarClicked(chosenbar) {
		if ($('#bar_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
		}
		showSpinner();
		// GET to change the users favorite bar
		$.get("http://nationwidebarcrawl.com/mobilenative/profile/setbar/" + chosenbar + "/", function(response) {
		});
		profileClicked();
	}
	
	// display/hide the profile change favorite beer page
	function profileChangeFavoriteBeerClicked() {
		if ($('#profile_change_favorite_beer_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers ul
			$('#profile_change_favorite_beer_ul').html('');
			// query the db for beers list
			db.transaction(queryProfileFavoriteBeerDB, errorCB);
		}
	}
	
	// Query the database for the beer list for profile_change_favorite_beer_page
	function queryProfileFavoriteBeerDB(tx) {
		tx.executeSql('SELECT * FROM beers', [], queryProfileFavoriteBeerSuccess, errorCB);
	}
	
	// Beers Imports DB Query Success Callback
	function queryProfileFavoriteBeerSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			$('#profile_change_favorite_beer_ul').append('<li><a href="#" onClick="profileFavoriteBeerClicked(\'' + beer.id + '\')">' + beer.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#profile_change_favorite_beer_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// Set the clicked beer as the profile favorite beer
	function profileFavoriteBeerClicked(chosenbeer) {
		if ($('#profile_change_favorite_beer_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
		}
		showSpinner();
		// GET to change the users favorite bar
		$.get("http://nationwidebarcrawl.com/mobilenative/profile/setbeer/" + chosenbeer + "/", function(response) {
		});
		profileClicked();
	}
	
	// show the profile change favorite drink page
	function profileChangeFavoriteDrinkClicked() {
		if ($('#profile_change_favorite_drink_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers ul
			$('#profile_change_favorite_drink_ul').html('');
			// query the db for beers list
			db.transaction(queryProfileFavoriteDrinksDB, errorCB);
		}
	}
	
	// Query the database for the drinks list for profile change favorite drink
	function queryProfileFavoriteDrinksDB(tx) {
		tx.executeSql('SELECT * FROM drinks', [], queryProfileFavoriteDrinksSuccess, errorCB);
	}
	
	// Drinks DB Query Success Callback for profile change favorite drink
	function queryProfileFavoriteDrinksSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			$('#profile_change_favorite_drink_ul').append('<li><a href="#" onClick="profileFavoriteDrinkClicked(\'' + drink.id + '\')">' + drink.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#profile_change_favorite_drink_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// Set the clicked drink as the profile favorite drink
	function profileFavoriteDrinkClicked(chosendrink) {
		if ($('#profile_change_favorite_drink_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
		}
		showSpinner();
		// GET to change the users favorite bar
		$.get("http://nationwidebarcrawl.com/mobilenative/profile/setdrink/" + chosendrink + "/", function(response) {
		});
		profileClicked();
	}
	
	// show the profile change favorite drinks page
	function profileChangeFavorite5DrinksClicked() {
		if ($('#profile_change_favorite_drinks_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers ul
			$('#profile_change_favorite_drinks_ul').html('');
			// query the db for beers list
			db.transaction(queryProfileFavorite5DrinksDB, errorCB);
		}
	}
	
	// Query the database for the drinks list for profile change favorite drinks
	function queryProfileFavorite5DrinksDB(tx) {
		tx.executeSql('SELECT * FROM drinks', [], queryProfileFavorite5DrinksSuccess, errorCB);
	}
	
	// Drinks DB Query Success Callback for profile change favorite drinks
	function queryProfileFavorite5DrinksSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			$('#profile_change_favorite_drinks_ul').append('<li><a href="#" onClick="profileChangeFavorite5DrinksAddClicked(\'' + drink.id + '\')">' + drink.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#profile_change_favorite_drinks_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	function profileChangeFavorite5DrinksAddClicked(chosendrink) {
		// GET to add a drink to the users 5 favorite drinks
		$.get("http://nationwidebarcrawl.com/mobilenative/profile/adddrink/" + chosendrink + "/", function(response) {
			// reload the profile db table
			window.localStorage.setItem("profiledbCreated", "0");
			profileClicked();
		});
	}
	
	function profileChangeFavorite5BeersClicked() {
		if ($('#profile_change_favorite_beers_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers ul
			$('#profile_change_favorite_beers_ul').html('');
			// query the db for beers list
			db.transaction(queryProfileFavorite5BeersDB, errorCB);
		}
	}
	
	// get the beers list from the DB for profile 5 favorite beers page
	function queryProfileFavorite5BeersDB(tx) {
		tx.executeSql('SELECT * FROM beers', [], queryProfileFavorite5BeersSuccess, errorCB);
	}
	
	// got beers list from DB for profile 5 favorite beers page
	function queryProfileFavorite5BeersSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++) {
			var beer = results.rows.item(i);
			$('#profile_change_favorite_beers_ul').append('<li><a href="#" onClick="profile5BeerAddClicked(\'' + beer.id + '\')">' + beer.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#profile_change_favorite_beers_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	function profile5BeerAddClicked(chosenbeer) {
		// GET to change the users favorite beer
		$.get("http://nationwidebarcrawl.com/mobilenative/profile/addbeer/" + chosenbeer + "/", function(response) {
			// reload the profile db table
			window.localStorage.setItem("profiledbCreated", "0");
			profileClicked();
		});
	}
	
	// display/hide the profile change image page
	function profileChangeImageClicked() {
		var auth_info = localStorage.getItem("isAuthenticated");
		if (auth_info == "0") {
			loginPageClicked();
		} else {
			if ($('#profile_change_image_page').is(':visible')) {
				upArrowClicked();
			} else {
				$('.hidden:visible').slideUp('slow');
				$('#profile_change_image_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			}
		}
	}
	
	// function to pop the camera for a new profile image
	function profileNewCameraPhoto() {
		showSpinner();
		navigator.camera.getPicture(captureProfileImageSuccess, captureError, {sourceType: Camera.PictureSourceType.CAMERA, destinationType: Camera.DestinationType.FILE_URI});
	}

	// function to pop the gallery for a new profile image
	function profileNewGalleryPhoto() {
		showSpinner();
		navigator.camera.getPicture(captureProfileImageSuccess, captureError, {sourceType: Camera.PictureSourceType.PHOTOLIBRARY, destinationType: Camera.DestinationType.FILE_URI});
	}
	
	// got new profile image, resolve the file URI
	function captureProfileImageSuccess(mediaFiles) {
		window.resolveLocalFileSystemURI(mediaFiles, gotProfileImageFilePath, null);
	}
	
	// got the file URI, upload the new profile image
	function gotProfileImageFilePath(fileEntry) {
		var options = new FileUploadOptions();
		options.fileKey="image";
		options.chunkedMode=false;
		var ft = new FileTransfer();
		ft.upload(fileEntry.fullPath, 'http://nationwidebarcrawl.com/mobilenative/profile/changeimage/', uploadProfileImageSuccess, uploadFail, options);
	}
	
	// new profile image successfully uploaded
	function uploadProfileImageSuccess() {
		alert('Profile Image Changed');
		hideSpinner();
		profileClicked();
	}
	
	// show friend requests for user
	function profileFriendRequestsPage() {
		if ($('#profile_friend_requests_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// clear the friend requests ul
			$('#profile_friend_requests_ul').html('');
			// fill in the friend reqeusts
			$.get("http://nationwidebarcrawl.com/mobilenative/friendrequests/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data['friendrequests'], function() {
					$('#profile_friend_requests_ul').append('<li><a href="#" onClick="profileUserClicked(' + this['memberpk'] + ')"><img src="http://nationwidebarcrawl.com' + this['profileimage'] + '" /><p>' + this['username'] + '</p></a></li>');
				});
				$('#profile_friend_requests_page').slideDown('slow', function() {
					setTimeout(function() {
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	//************************************************************
	//
	// DRINKS BUTTON ON FOOTER
	//
	//************************************************************
	
	// display/hide drinks page
	function showDrinksPage() {
		if ($('#drinks_footer_button_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			$('#drinks_footer_button_page').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
			});
			$('#up_arrow').show();
		}
	}
	
	//************************************************************
	//
	// DRINKS
	// 
	//************************************************************
	
	// function to grab the drinks list and save them to the database
	function onDrinksMainReady() {
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onDrinksMainFSSuccess, errorHandler);
		if (drinksdbCreated != 1) {
			// TODO: show loading screen here
        	db.transaction(populateDrinksMainDB, errorCB, successDrinksMainCB);
		}
	}

	// got filesystem hook, navigate the filesystem
	function onDrinksMainFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},null,null);
		fileSystem.root.getDirectory("NWBC/drinks",{create:true},null,errorHandler);
	}

	// Populate the database with the drinks table
	function populateDrinksMainDB(tx) {
		tx.executeSql('DROP TABLE IF EXISTS drinks');
		tx.executeSql('CREATE TABLE IF NOT EXISTS drinks(id INTEGER, name, glass, type, slug, imageurl, imagename)');
		$.ajaxSetup({async: false});
		$.get("http://nationwidebarcrawl.com/mobilenative/DrinksFinalList/", function(response) {
			var parsed_data = $.parseJSON(response);
			for(var i=0;i<parsed_data.length;i++){
				var drink = parsed_data[i];
				var imagename = drink['image'];
				imagename = imagename.substring(imagename.lastIndexOf('/')+1);
				tx.executeSql('INSERT INTO drinks (id, name, glass, type, slug, imageurl, imagename) VALUES (' + drink['pk'] + ', "' + drink['name'] + '", "' + drink['glass'] + '", "' + drink['type'] + '", "' + drink['slug'] + '", "' + drink['image'] + '", "' + imagename + '")');
			}
			localStorage.setItem("drinksdbCreated", "1");
		});
	}

	// Transaction success callback
	function successDrinksMainCB() {
		upArrowClicked();
		alert('Drinks database created successfully');
		window.location.href="./index.html";
	}
	
	// display/hide the drinks main page
	function drinksMainClicked() {
		if ($('#drinks_main_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			$('#drinks_main_page').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
			});
			$('#up_arrow').show();
		}
	}
	
	// display/hide the drinks abc page
	function drinksABCClicked() {
		if ($('#drinks_abc_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the drinks abc ul
			$('#drinks_abc_ul').html('');
			// query the db for drinks abc list
			db.transaction(queryDrinksABCDB, errorCB);
		}
	}
	
	// Query the database for the drinks list for drinks_abc_page
	function queryDrinksABCDB(tx) {
		tx.executeSql('SELECT * FROM drinks', [], queryDrinksABCSuccess, errorCB);
	}
	
	// Drinks ABC DB Query Success Callback
	function queryDrinksABCSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			$('#drinks_abc_ul').append('<li><a href="#" onClick="singleDrinkClicked(\'' + drink.id + '\')">' + drink.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#drinks_abc_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// display/hide the drinks types page
	function drinksTypesClicked() {
		if ($('#drinks_types_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the drinks types ul
			$('#drinks_types_ul').html('');
			// query the db for drink types list
			db.transaction(queryDrinksTypesDB, errorCB);
		}
	}
	
	// Query the database to get the list of drink types for drinks_types_page
	function queryDrinksTypesDB(tx) {
		tx.executeSql('SELECT DISTINCT type FROM drinks', [], queryDrinksTypesSuccess, errorCB);
	}
	
	// Drinks Types DB Query Success Callback
	function queryDrinksTypesSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			$('#drinks_types_ul').append('<li><a href="#" onClick="drinksTypeClicked(\'' + drink.type + '\')">' + drink.type + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#drinks_types_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// display/hide the drinks type page
	function drinksTypeClicked(chosendrinktype) {
		if ($('#drinks_type_page').is(':visible')) {
			upArrowClicked();
		} else {
			window.localStorage.setItem("chosendrinktype", chosendrinktype);
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the drinks type ul
			$('#drinks_type_ul').html('');
			// query the db for drink type list
			db.transaction(queryDrinksTypeDB, errorCB);
		}
	}
	
	// Query the database for all the drinks of chosen drink type for drinks_type_page
	function queryDrinksTypeDB(tx) {
		var chosendrinktype = window.localStorage.getItem("chosendrinktype");
		tx.executeSql('SELECT * FROM drinks WHERE type=?', [chosendrinktype], queryDrinksTypeSuccess, errorCB);
	}
	
	// Drinks Type DB Query Success Callback
	function queryDrinksTypeSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var drink = results.rows.item(i);
			$('#drinks_type_ul').append('<li><a href="#" onClick="singleDrinkClicked(\'' + drink.id + '\')">' + drink.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#drinks_type_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// display/hide the random drink page
	function randomDrinkClicked() {
		if ($('#drinks_random_drink_page').is(':visible')) {
			upArrowClicked();
		} else {
			showSpinner();
			// clear random drink info
			$('#randomDrink_float_left').html('');
			$('#random_drink_photos_holder').html('');
			$('#random_drink_photos').html('');
			$('#random_drink_members_holder').html('');
			$('#random_drink_members').html('');
			$('.hidden:visible').slideUp('slow');	
			// get random drink from db
			db.transaction(queryRandomDrinkDB, errorCB, function(){});
		}
	}
	
	// Query the drinks database for a random drink
	function queryRandomDrinkDB(tx) {
		tx.executeSql('SELECT * FROM drinks', [], queryRandomDrinkSuccess, errorCB);
	}
	
	// Query Random Drink DB Success Callback
	function queryRandomDrinkSuccess(tx, results) {
		var len = results.rows.length;
		var randomid = Math.floor(Math.random() * len) + 1;
		var drink = results.rows.item(randomid);
		getRandomDrinkFavoritesAndPhotos(drink.id);
		window.localStorage.setItem("drinkimagename", drink.imagename);
		window.localStorage.setItem("drinkimageurl", drink.imageurl);
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onRandomDrinkFSSuccess, errorHandler);
		$('#randomDrink_float_left').append('<p>' + drink.name + '</p>');
		$('#randomDrink_float_left').append('<p>Glass:<br />' + drink.glass + '</p>');
		$('#randomDrink_float_left').append('<p>Type:<br /><a href="#" onClick="drinksTypeClicked(\'' + drink.type + '\')">' + drink.type + '</a></p>');
	}
	
	// Function to get favorite people and recent images for a random drink
	function getRandomDrinkFavoritesAndPhotos(selecteddrink) {
		$.get("http://nationwidebarcrawl.com/mobilenative/drinks/pk/" + selecteddrink + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			if(parsed_data['drinkphotos'].length > 0) {
				$('#random_drink_photos_holder').append('<div class="mobile_hr"></div><h1>Recently Tagged Photos:</h1>');
			}
			$.each(parsed_data['drinkphotos'], function() {
				$('#random_drink_photos').append('<li><img src="http://nationwidebarcrawl.com' + this['imageurl'] + '" /></li>');
			});
			if(parsed_data['members'].length > 0) {
				$('#random_drink_members_holder').append('<div class="mobile_hr"></div><h1>Favorite Drink For:</h1>');
			}
			$.each(parsed_data['members'], function() {
				$('#random_drink_members').append('<li><img src="http://nationwidebarcrawl.com' + this['profileimage'] + '" /></li>');
			});
			$('#drinks_random_drink_page').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
					hideSpinner();
				}, 1000);
			});
			$('#up_arrow').show();
		});
	}
	
	// got filesystem for random drink image
	function onRandomDrinkFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/drinks",{create:true},gotRandomDrinkDir,onError);
	}
	
	// got filesystem directory for random drink image
	function gotRandomDrinkDir(d){
		DATADIR = d;
		d.getFile(window.localStorage.getItem("drinkimagename"), {create: false}, gotRandomDrinkFile, noRandomDrinkFile);
	}
	
	// got file for random drink image
	function gotRandomDrinkFile(fileEntry) {
		$('#random_drink_image_img').attr("src", fileEntry.fullPath);
	}
	
	// drink image file not found, download it and cache it on the filesystem
	function noRandomDrinkFile() {
		// get drink image url from local storage
		var drinkimageurl = window.localStorage.getItem("drinkimageurl");
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DATADIR.fullPath + "/" + drinkimageurl.substring(drinkimageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + drinkimageurl, dlPath, function(entry) {$('#random_drink_image_img').attr("src", entry.fullPath);}, null);
	}
	
	// display/hide the single drink page
	function singleDrinkClicked(selecteddrink) {
		if ($('#drinks_single_drink_page').is(':visible')) {
			upArrowClicked();
		} else {
			window.localStorage.setItem("selecteddrink", selecteddrink);
			showSpinner();
			// clear single drink info
			$('#drinks_single_float_left').html('');
			$('#drinks_single_photos_holder').html('');
			$('#drinks_single_photos').html('');
			$('#drinks_single_members_holder').html('');
			$('#drinks_single_members').html('');
			$('.hidden:visible').slideUp('slow');
			// get single drink from db
			db.transaction(querySingleDrinkDB, errorCB, function(){});
		}
	}
	
	// Query the database for a single drink info for drinks_single_drink_page
	function querySingleDrinkDB(tx) {
		var selecteddrink = window.localStorage.getItem("selecteddrink");
		tx.executeSql('SELECT * FROM drinks WHERE id = ?', [selecteddrink], querySingleDrinkSuccess, errorCB);
	}
	
	// Single Drink DB Query Success Callback
	function querySingleDrinkSuccess(tx, results) {
		var drink = results.rows.item(0);
		getSingleDrinkFavoritesAndPhotos(drink.id);
		window.localStorage.setItem("drinkimagename", drink.imagename);
		window.localStorage.setItem("drinkimageurl", drink.imageurl);
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSingleDrinkFSSuccess, errorHandler);
		$('#drinks_single_float_left').append('<p>' + drink.name + '</p>');
		$('#drinks_single_float_left').append('<p>Glass:<br />' + drink.glass + '</p>');
		$('#drinks_single_float_left').append('<p>Type:<br /><a href="#" onClick="drinksTypeClicked(\'' + drink.type + '\')">' + drink.type + '</a></p>');
	}
	
	// Got FileSystem for Single Drink Image, get image directory
	function onSingleDrinkFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:false},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/drinks",{create:false},gotSingleDrinkDir,onError);
	}
	
	// Got FileSystem Directory for single image, get image file
	function gotSingleDrinkDir(d){
		DATADIR = d;
		var drinkimagename = window.localStorage.getItem("drinkimagename");
		d.getFile(drinkimagename, {create: false}, gotSingleDrinkFile, noSingleDrinkFile);
	}
	
	// Got file for image for Single Drink, set img src in the template
	function gotSingleDrinkFile(fileEntry) {
		$('#drinks_single_image_img').attr("src", fileEntry.fullPath);
	}

	// Image file for Single Drink not found, download it, cache it to the SD card and display it in the template
	function noSingleDrinkFile() {
		var drinkimageurl = window.localStorage.getItem("drinkimageurl");
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DATADIR.fullPath + "/" + drinkimageurl.substring(drinkimageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + drinkimageurl, dlPath, function(entry) {$('#drinks_single_image_img').attr("src", entry.fullPath);}, null);
	}
	
	// get Favorite People and Recent Images for drinks_single_drink_page
	function getSingleDrinkFavoritesAndPhotos(selecteddrink) {
		$.get("http://nationwidebarcrawl.com/mobilenative/drinks/pk/" + selecteddrink + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			if(parsed_data['drinkphotos'].length > 0) {
				$('#drinks_single_photos_holder').append('<div class="mobile_hr"></div><h1>Recently Tagged Photos:</h1>');
			}
			$.each(parsed_data['drinkphotos'], function() {
				$('#drinks_single_photos').append('<li><img src="http://nationwidebarcrawl.com' + this['imageurl'] + '" /></li>');
			});
			if(parsed_data['members'].length > 0) {
				$('#drinks_single_members_holder').append('<div class="mobile_hr"></div><h1>Favorite Drink For:</h1>');
				$.each(parsed_data['members'], function() {
					$('#drinks_single_members').append('<li><a href="#" onClick="profileUserClicked(' + this['userpk'] + ')"><img src="http://nationwidebarcrawl.com' + this['profileimage'] + '" /></a></li>');
				});
			}
			$('#drinks_single_drink_page').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
					hideSpinner();
				}, 1000);
			});
			$('#up_arrow').show();
		});
	}
	
	//************************************************************
	//
	// BEERS
	// 
	//************************************************************
	
	// this function is to be fired from appinit to pull down the beers into the database
	function onBeersMainReady() {
		//get the filesystem for writing images
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onBeersReadyFSSuccess, errorHandler);
	}

	// got the filesystem link, navigate the filesystem hierarchy
	function onBeersReadyFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},null,null);
		fileSystem.root.getDirectory("NWBC/beers",{create:true},gotBeersReadyDir,onError);
	}

	// found our desired directory for beer images
	function gotBeersReadyDir(d){
		DATADIR = d;
		if (dbCreated != 1) {
			//$.mobile.loading( 'show', { theme: "a", text: "Loading Beers Database", textVisible: true});
			db.transaction(populateBeersReadyDB, errorCB, successBeersReadyCB);
		}
	}

	// Populate the database with the beers table
	function populateBeersReadyDB(tx) {
		tx.executeSql('DROP TABLE IF EXISTS beers');
		tx.executeSql('CREATE TABLE IF NOT EXISTS beers(id INTEGER, name, slug, brewery, brewerypk, type, locality, imagename, imageurl, isPopular)');
		$.ajaxSetup({async: false});
		$.get("http://nationwidebarcrawl.com/mobilenative/BeersFinalList/", function(response) {
			var parsed_data = $.parseJSON(response);
			for(var i=0;i<parsed_data.length;i++){
				var beer = parsed_data[i];
				var imagename = beer['image'];
				imagename = imagename.substring(imagename.lastIndexOf('/')+1);
				if (beer['isPopular']) {downloadBeersReadyThumbnail(beer['image']);}
				tx.executeSql('INSERT INTO beers (id, name, slug, brewery, brewerypk, type, locality, imagename, imageurl, isPopular) VALUES (' + beer['pk'] + ', "' + beer['name'] + '", "' + beer['slug'] + '", "' + beer['brewery'] + '", "' + beer['brewery_pk'] + '", "' + beer['type'] + '", "' + beer['locality'] + '", "' + imagename + '", "' + beer['image'] + '", "' + beer['isPopular'] + '")');
			}
			localStorage.setItem("dbCreated", "1");
		});
	}

	// Transaction success callback for populating the beers database
	function successBeersReadyCB() {
		upArrowClicked();
		alert('Finished loading the Beers Database');
		window.location.href="./index.html";
	}

	// Download the thumbnail for a beer and write it to the filesystem
	function downloadBeersReadyThumbnail(imageURL) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DATADIR.fullPath + "/" + imageURL.substring(imageURL.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageURL, dlPath, function(){}, function(){});
	}
	
	// display/hide the beers main page
	function beersMainClicked() {
		if ($('#beers_main_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			$('#beers_main_page').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
			});
			$('#up_arrow').show();
		}
	}
	
	// display/hide the beers abc page
	function beersABCClicked() {
		if ($('#beers_abc_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers abc ul
			$('#beers_abc_ul').html('');
			// query the db for beers list
			db.transaction(queryBeersABCDB, errorCB);
		}
	}
	
	// Query the beers database to get the alphabetical listing of beers
	function queryBeersABCDB(tx) {
		tx.executeSql('SELECT * FROM beers', [], queryBeersABCSuccess, errorCB);
	}
	
	// beers ABC databse query success callback
	function queryBeersABCSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++) {
			var beer = results.rows.item(i);
			$('#beers_abc_ul').append('<li><a href="#" onClick="singleBeerClicked(\'' + beer.id + '\')">' + beer.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#beers_abc_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// display/hide the beers breweries page
	function beersBreweriesClicked() {
		if ($('#beers_breweries_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers breweries ul
			$('#beers_breweries_ul').html('');
			// query the db for beers list
			db.transaction(queryBeersBreweriesDB, errorCB);
		}
	}
	
	// Query the database for a list of unique breweries for beers_breweries_page
	function queryBeersBreweriesDB(tx) {
		tx.executeSql('SELECT DISTINCT brewery, brewerypk FROM beers', [], queryBeersBreweriesSuccess, errorCB);
	}
	
	// Beers Breweries DB success callback
	function queryBeersBreweriesSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			$('#beers_breweries_ul').append('<li><a href="#" onClick="beersBreweryClicked(\'' + beer.brewerypk + '\')">' + beer.brewery + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#beers_breweries_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// display/hide the beers brewery page
	function beersBreweryClicked(chosenbrewerypk) {
		if ($('#beers_brewery_page').is(':visible')) {
			upArrowClicked();
		} else {
			window.localStorage.setItem("chosenbrewery", chosenbrewerypk);
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers brewery ul
			$('#beers_brewery_beer_ul').html('');
			// query the db for beers list
			db.transaction(queryBeersBreweryDB, errorCB);
		}
	}

	// Query the database to get the beers list for a chosen brewery
	function queryBeersBreweryDB(tx) {
		var chosenbrewerypk = window.localStorage.getItem("chosenbrewery");
		tx.executeSql('SELECT * FROM beers WHERE brewerypk=?', [chosenbrewerypk], queryBeersBrewerySuccess, errorCB);
	}

	// Beers Brewery DB Success Callback
	function queryBeersBrewerySuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			$('#beers_brewery_beer_ul').append('<li><a href="#" onClick="singleBeerClicked(\'' + beer.id + '\')">' + beer.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#beers_brewery_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// display/hide the beers types page
	function beersTypesClicked() {
		if ($('#beers_types_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers types ul
			$('#beers_types_ul').html('');
			// query the db for beers list
			db.transaction(queryBeersTypesDB, errorCB);
		}
	}
	
	// Query the database for the list of beer types for beers_types_page
	function queryBeersTypesDB(tx) {
		tx.executeSql('SELECT DISTINCT type FROM beers', [], queryBeersTypesSuccess, errorCB);
	}
	
	// Beers Types DB Success Callback
	function queryBeersTypesSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			$('#beers_types_ul').append('<li><a href="#" onClick="beersTypeClicked(\'' + beer.type + '\')">' + beer.type + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#beers_types_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}

	// display/hide the beers type page
	function beersTypeClicked(chosenbeertype) {
		if ($('#beers_type_page').is(':visible')) {
			upArrowClicked();
		} else {
			window.localStorage.setItem("chosenbeertype", chosenbeertype);
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers type ul
			$('#beers_type_ul').html('');
			// query the db for beers list
			db.transaction(queryBeersTypeDB, errorCB);
		}
	}
	
	// Query the database for all the beers of a chosen type
	function queryBeersTypeDB(tx) {
		var chosentype = window.localStorage.getItem("chosenbeertype");
		tx.executeSql('SELECT * FROM beers WHERE type=?', [chosentype], queryBeersTypeSuccess, errorCB);
	}
	
	// Beers Type DB Query Success Callback
	function queryBeersTypeSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			$('#beers_type_ul').append('<li><a href="#" onClick="singleBeerClicked(\'' + beer.id + '\')">' + beer.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#beers_type_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// display/hide the beers domestics page
	function beersDomesticsClicked() {
		if ($('#beers_domestics_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers brewery ul
			$('#beers_domestics_ul').html('');
			// query the db for beers list
			db.transaction(queryBeersDomesticsDB, errorCB);
		}
	}
	
	// Query the database for the domestic beers for beers_domestics_page
	function queryBeersDomesticsDB(tx) {
		tx.executeSql('SELECT * FROM beers WHERE locality=?', ['Domestic'], queryBeersDomesticsSuccess, errorCB);
	}

	// Beers Domestics DB Success Callback
	function queryBeersDomesticsSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			$('#beers_domestics_ul').append('<li><a href="#" onClick="singleBeerClicked(\'' + beer.id + '\')">' + beer.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#beers_domestics_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}
	
	// display/hide the beers imports page
	function beersImportsClicked() {
		if ($('#beers_imports_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the beers brewery ul
			$('#beers_imports_ul').html('');
			// query the db for beers list
			db.transaction(queryBeersImportsDB, errorCB);
		}
	}
	
	// Query the database for the import beer list for beers_imports_page
	function queryBeersImportsDB(tx) {
		tx.executeSql('SELECT * FROM beers WHERE locality=?', ['Import'], queryBeersImportsSuccess, errorCB);
	}
	
	// Beers Imports DB Query Success Callback
	function queryBeersImportsSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var beer = results.rows.item(i);
			$('#beers_imports_ul').append('<li><a href="#" onClick="singleBeerClicked(\'' + beer.id + '\')">' + beer.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		$('#beers_imports_page').slideDown('slow', function() {
			setTimeout(function() {
				myScroll.refresh();
			}, 0);
			hideSpinner();
		});
		$('#up_arrow').show();
	}

	// display/hide the random beer page
	function randomBeerClicked() {
		if ($('#beers_random_beer_page').is(':visible')) {
			upArrowClicked();
		} else {
			showSpinner();
			// clear random beer info
			$('#randomBeer_float_left').html('');
			$('#random_beer_tagged_photos_holder').html('');
			$('#random_beer_photos').html('');
			$('#random_beer_favorite_members_holder').html('');
			$('#random_beer_members').html('');
			$('.hidden:visible').slideUp('slow');	
			// get random beer from db
			db.transaction(queryRandomBeerDB, errorCB, function(){});
		}
	}
	
	// Query the beers database for a random beer
	function queryRandomBeerDB(tx) {
		tx.executeSql('SELECT * FROM beers', [], queryRandomBeerSuccess, errorCB);
	}
	
	// Query random beer db success callback
	function queryRandomBeerSuccess(tx, results) {
		var len = results.rows.length;
		var randomid = Math.floor(Math.random() * len) + 1;
		var beer = results.rows.item(randomid);
		getRandomBeerFavoritesAndPhotos(beer.id);
		window.localStorage.setItem("beerimagename", beer.imagename);
		window.localStorage.setItem("beerimageurl", beer.imageurl);
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onRandomBeerFSSuccess, errorHandler);
		$('#randomBeer_float_left').append('<p>' + beer.name + '</p>');
		$('#randomBeer_float_left').append('<p>Brewery:<br /><a href="#" onClick="beersBreweryClicked(\'' + beer.brewerypk + '\')">' + beer.brewery + '</a></p>');
		if (beer.locality == "Domestic") {
			$('#randomBeer_float_left').append('<p>Locality:<br /><a href="#" onClick="beersDomesticsClicked()">' + beer.locality + '</a></p>');
		} else {
			$('#randomBeer_float_left').append('<p>Locality:<br /><a href="#" onClick="beersImportsClicked()">' + beer.locality + '</a></p>');
		}
		$('#randomBeer_float_left').append('<p>Type:<br /><a href="#" onClick="beersTypeClicked(\'' + beer.type + '\')">' + beer.type + '</a></p>');
	}
	
	// Function to get random beer favorite people and recent images
	function getRandomBeerFavoritesAndPhotos(selectedbeer) {
		$.get("http://nationwidebarcrawl.com/mobilenative/beers/pk/" + selectedbeer + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			if(parsed_data['taggedphotos'].length > 0) {
				$('#random_beer_tagged_photos_holder').append('<div class="mobile_hr"></div><h1>Recently Tagged Photos:</h1>');
			}
			$.each(parsed_data['taggedphotos'], function() {
				$('#random_beer_photos').append('<li><img src="http://nationwidebarcrawl.com' + this['imageurl'] + '" /></li>');
			});
			if(parsed_data['members'].length > 0) {
				$('#random_beer_favorite_members_holder').append('<div class="mobile_hr"></div><h1>Favorite Beer For:</h1>');
			}
			$.each(parsed_data['members'], function() {
				$('#random_beer_members').append('<li><img src="http://nationwidebarcrawl.com' + this['profileimage'] + '" /></li>');
			});
			$('#beers_random_beer_page').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
					hideSpinner();
				}, 1000);
			});
			$('#up_arrow').show();
		});
	}
	
	// got filesystem for random beer image
	function onRandomBeerFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/beers",{create:true},gotRandomBeerDir,onError);
	}
	
	// got filesystem for random beer image, get random beer image file
	function gotRandomBeerDir(d){
		DATADIR = d;
		d.getFile(window.localStorage.getItem("beerimagename"), {create: false}, gotRandomBeerFile, noRandomBeerFile);
	}
	
	// got file for random beer image, add it to the template
	function gotRandomBeerFile(fileEntry) {
		$('#random_beer_image_img').attr("src", fileEntry.fullPath);
	}
	
	// random beer image file not found, download it, cache it and add it to the template
	function noRandomBeerFile() {
		// create fileTransfer object
		var ft = new FileTransfer();
		var beerimageurl = window.localStorage.getItem("beerimageurl");
		var dlPath = DATADIR.fullPath + "/" + beerimageurl.substring(beerimageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + beerimageurl, dlPath, function(entry) {$('#random_beer_image_img').attr("src", entry.fullPath);}, null);
	}
	
	// display/hide the single beer page
	function singleBeerClicked(selectedbeer) {
		if ($('#beers_single_beer_page').is(':visible')) {
			upArrowClicked();
		} else {
			window.localStorage.setItem("selectedbeer", selectedbeer);
			showSpinner();
			// clear single beer info
			$('#single_beer_float_left').html('');
			$('#single_beer_tagged_photos_holder').html('');
			$('#single_beer_photos').html('');
			$('#single_beer_favorite_members_holder').html('');
			$('#single_beer_members').html('');
			$('.hidden:visible').slideUp('slow');	
			// get single beer from db
			db.transaction(querySingleBeerDB, errorCB, function(){});
		}
	}
	
	// Query the database for a single beer
	function querySingleBeerDB(tx) {
		var selectedbeer = window.localStorage.getItem("selectedbeer");
		tx.executeSql('SELECT * FROM beers WHERE id = ?', [selectedbeer], querySingleBeerSuccess, errorCB);
	}
	
	// Single Beer DB Querry Success Callback
	function querySingleBeerSuccess(tx, results) {
		var beer = results.rows.item(0);
		getSingleBeerFavoritesAndPhotos(beer.id);
		window.localStorage.setItem("beerimagename", beer.imagename);
		window.localStorage.setItem("beerimageurl", beer.imageurl);
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSingleBeerFSSuccess, errorHandler);
		$('#single_beer_float_left').append('<p>' + beer.name + '</p>');
		$('#single_beer_float_left').append('<p>Brewery:<br /><a href="#" onClick="beersBreweryClicked(\'' + beer.brewerypk + '\')">' + beer.brewery + '</a></p>');
		if (beer.locality == "Domestic") {
			$('#single_beer_float_left').append('<p>Locality:<br /><a href="#" onClick="beersDomesticsClicked()">' + beer.locality + '</a></p>');
		} else {
			$('#single_beer_float_left').append('<p>Locality:<br /><a href="#" onClick="beersImportsClicked()">' + beer.locality + '</a></p>');
		}
		$('#single_beer_float_left').append('<p>Type:<br /><a href="#" onClick="beersTypeClicked(\'' + beer.type + '\')">' + beer.type + '</a></p>');
	}
	
	// Got FS, get directory for single beer image
	function onSingleBeerFSSuccess(fileSystem) {
		fileSystem.root.getDirectory("NWBC",{create:false},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/beers",{create:false},gotSingleBeerDir,onError);
	}
	
	// Got DIR for single beer image file, get file
	function gotSingleBeerDir(d) {
		DATADIR = d;
		var beerimagename = window.localStorage.getItem("beerimagename");
		d.getFile(beerimagename, {create: false}, gotSingleBeerFile, noSingleBeerFile);
	}
	
	// Got file on filesystem, add to template
	function gotSingleBeerFile(fileEntry) {
		$('#beers_single_image_img').attr("src", fileEntry.fullPath);
	}
	
	// No file for single beer, download image file, cache to SD and display in template
	function noSingleBeerFile() {
		var beerimageurl = window.localStorage.getItem("beerimageurl");
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DATADIR.fullPath + "/" + beerimageurl.substring(beerimageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + beerimageurl, dlPath, function(entry) {$('#beers_single_image_img').attr("src", entry.fullPath);}, null);
	}
	
	// Get Favorite People and Recent Images for selected beer
	function getSingleBeerFavoritesAndPhotos(selectedbeer) {
		$.get("http://nationwidebarcrawl.com/mobilenative/beers/pk/" + selectedbeer + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			if(parsed_data['taggedphotos'].length > 0) {
				$('#single_beer_tagged_photos_holder').append('<div class="mobile_hr"></div><h1>Recently Tagged Photos:</h1>');
			}
			$.each(parsed_data['taggedphotos'], function() {
				$('#single_beer_photos').append('<li><img src="http://nationwidebarcrawl.com' + this['imageurl'] + '" /></li>');
			});
			if(parsed_data['members'].length > 0) {
				$('#single_beer_favorite_members_holder').append('<div class="mobile_hr"></div><h1>Favorite Beer For:</h1>');
			}
			$.each(parsed_data['members'], function() {
				$('#single_beer_members').append('<li><a href="#" onClick="profileUserClicked(' + this['userpk'] + ')"><img src="http://nationwidebarcrawl.com' + this['profileimage'] + '" /></a></li>');
			});
			$('#beers_single_beer_page').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
					hideSpinner();
				}, 1000);
			});
			$('#up_arrow').show();
		});
	}
	
	//************************************************************
	//
	// BARS
	//
	//************************************************************
	
	// display/hide the single bar page
	function singleBarClicked(selectedbar) {
		if ($('#single_bar_page').is(':visible')) {
			upArrowClicked();
		} else {
			// set selected bar for retreival later
			window.localStorage.setItem("chosenbar", selectedbar);
			showSpinner();
			// clear single bar info
			$('#bar_info').html('');
			$('#bar_tap_info_holder').html('');
			$('#bar_beerlist_ul').html('');
			$('#bar_bottle_info_holder').html('');
			$('#bar_bottlelist_ul').html('');
			$('#bar_photos_holder').html('');
			$('#bar_photos').html('');
			$('#bar_members_holder').html('');
			$('#bar_members').html('');			
			$('.hidden:visible').slideUp('slow');	
			// get file system access
			window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSingleBarFSSuccess, errorHandler);
			// fire ajax requests at the same time, no db, no need to wait
			getSingleBarFavoritesAndPhotos();
		}
	}
	
	// got filesystem for single bar, get directory for beer images
	function onSingleBarFSSuccess(fileSystem) {
		// get beers directory
		fileSystem.root.getDirectory("NWBC",{create:true},function(){},function(){});
		fileSystem.root.getDirectory("NWBC/beers",{create:true},gotSingleBarDir,onError);
	}
	
	// got beers directory, get list of beers for bar
	function gotSingleBarDir(d){
		DATADIR = d;
		// variable to hold selected bar
		var selectedbar = window.localStorage.getItem("chosenbar");
		// variable for bar beers list
		var barbeerslistcreated = window.localStorage.getItem("barbeerslistcreated");
		// got beers directory for images, get database
		if (!barbeerslistcreated || barbeerslistcreated == "") {
			db.transaction(populateSingleBarDB, errorCB, function(){successSingleBarCB();});
		} else {
			if (barbeerslistcreated.search(selectedbar) == "-1") {
    			db.transaction(populateSingleBarDB, errorCB, function(){successSingleBarCB();});
    		} else {
    			db.transaction(querySingleBarDB, errorCB, function(){});
    		}
   		}
	}
	
	// Query the database for the beer list for a single bar
	function querySingleBarDB(tx) {
		// variable to hold the selected bar
		var selectedbar = window.localStorage.getItem("chosenbar");
		tx.executeSql('SELECT * FROM bars WHERE id = ?', [selectedbar], querySingleBarSuccess, errorCB);
		tx.executeSql('SELECT imagename, imageurl, id, isTap FROM beers INNER JOIN barbeerslist ON beers.id=barbeerslist.beerid WHERE barbeerslist.barid = ?', [selectedbar], beerslistSingleBarquerySuccess, errorCB);
	}
	
	// Single Bar DB Query Success Callback
	function querySingleBarSuccess(tx, results) {
		var bar = results.rows.item(0);
		$('#bar_info').append('<p id="bar_detail_name">' + bar.name + '</p>');
		$('#bar_info').append('<p id="bar_detail_address">' + bar.address + '</p>');
		$('#bar_info').append('<p id="bar_detail_phone"><a href="tel:' + bar.phone + '">' + bar.phone + '</a></p>');
		$('#bar_info').append('<p id="bar_detail_website"><a href="' + bar.website + '">' + bar.website + '</a></p>');
	}
	
	// Single Bar DB Query for Beers List Success Callback
	function beerslistSingleBarquerySuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++) {
			var beer = results.rows.item(i);
			if (beer.isTap == "true") {
				if (tapBeersAdded == false) {
					$('#bar_tap_info_holder').append('<div class="mobile_hr"></div><h1 id="bar_tap_title">Beers on Tap:</h1>');
					tapBeersAdded=true;
				}
				addSingleBarTapBeer(beer.imagename, beer.imageurl, beer.id);
			} else {
				if (bottleBeersAdded == false) {
					$('#bar_bottle_info_holder').append('<div class="mobile_hr"></div><h1 id="bar_bottle_title">Beers in Bottle:</h1>');
					bottleBeersAdded=true;
				}
				addSingleBarBottleBeer(beer.imagename, beer.imageurl, beer.id);
			}
    	}
    	// clear variables so they are reset when viewing the next bar
    	tapBeersAdded=false;
    	bottleBeersAdded=false;
	}
	
	// add a beer to the Single Bar Tap List
	function addSingleBarTapBeer(imagename, imageurl, id) {
		DATADIR.getFile(imagename,{create: false},function(fileEntry){gotSingleBarTapFile(fileEntry, id);},function(){noSingleBarTapFile(imageurl);});
	}
	
	// add a beer to the Single Bar Bottle List
	function addSingleBarBottleBeer(imagename, imageurl, id) {
		DATADIR.getFile(imagename,{create: false},function(fileEntry){gotSingleBarBottleFile(fileEntry, id);},function(){noSingleBarBottleFile(imageurl);});
	}
	
	// add a beer to the Single Bar Tap List in the template
	function gotSingleBarTapFile(fileEntry, id) {
		$('#bar_beerlist_ul').append('<li><a href="#" onClick="singleBeerClicked(' + id + ')"><img src="' + fileEntry.fullPath + '" /></a></li>');
	}
	
	// add a beer to the Single Bar Bottle List in the template
	function gotSingleBarBottleFile(fileEntry, id) {
		$('#bar_bottlelist_ul').append('<li><a href="#" onClick="singleBeerClicked(' + id + ')"><img src="' + fileEntry.fullPath + '" /></a></li>');
	}
	
	// get thumbnail for a Single Bar tap beer
	function noSingleBarTapFile(imageurl) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(entry) {$('#bar_beerlist_ul').append('<li><img src="' + entry.fullPath + '" /></li>');}, null);
	}
	
	// get thumbnail for a Single Bar bottle beer
	function noSingleBarBottleFile(imageurl) {
		// create fileTransfer object
		var ft = new FileTransfer();
		var dlPath = DATADIR.fullPath + "/" + imageurl.substring(imageurl.lastIndexOf('/')+1);
		ft.download("http://nationwidebarcrawl.com" + imageurl, dlPath, function(entry) {$('#bar_bottlelist_ul').append('<li><img src="' + entry.fullPath + '" /></li>');}, null);
	}
	
	// Populate the bars database 
	function populateSingleBarDB(tx) {
		// variable to hold selected bar
		var selectedbar = window.localStorage.getItem("chosenbar");
		tx.executeSql('CREATE TABLE IF NOT EXISTS barbeerslist(barid, beerid, isTap)');
		$.ajaxSetup({async: false});
		$.get("http://nationwidebarcrawl.com/mobilenative/barbeerlist/" + selectedbar + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			var len = parsed_data.length;
			for(var i=0;i<parsed_data.length;i++) {
				var beer = parsed_data[i];
				beerVarString = [selectedbar, beer['beerpk'], beer['isTap']];
				tx.executeSql('INSERT INTO barbeerslist (barid, beerid, isTap) VALUES (?, ?, ?)', beerVarString);
			}
			var donedbs = localStorage.getItem("barbeerslistcreated");
			donedbs += ", " + selectedbar;
			localStorage.setItem("barbeerslistcreated", donedbs);
		});
	}
	
	// Transaction success callback for Single Bar
	function successSingleBarCB() {
		db.transaction(querySingleBarDB, errorCB, function(){});
	}
	
	// Single Bar get favorite people and recent images
	function getSingleBarFavoritesAndPhotos() {
		var selectedbar = window.localStorage.getItem("chosenbar");
		$.get("http://nationwidebarcrawl.com/mobilenative/bar/pk/" + selectedbar + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			if(parsed_data['barphotos'].length > 0) {
				$('#bar_photos_holder').append('<div class="mobile_hr"></div><h1>Recently Tagged Photos:</h1>');
			}
			$.each(parsed_data['barphotos'], function() {
				$('#bar_photos').append('<li><img src="http://nationwidebarcrawl.com' + this['imageurl'] + '" /></li>');
			});
			if(parsed_data['members'].length > 0) {
				$('#bar_members_holder').append('<div class="mobile_hr"></div><h1>Favorite Bar for:</h1>');
			}
			$.each(parsed_data['members'], function() {
				$('#bar_members').append('<li><a href="#" onClick="profileUserClicked(' + this['userpk'] + ')"><img src="http://nationwidebarcrawl.com' + this['profileimage'] + '" /></a></li>');
			});
			$('#single_bar_page').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
					hideSpinner();
				}, 2000);
			});
			$('#up_arrow').show();
		});
	}
	
	// display/hide the state list for the bars button
	function showBarStates() {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_states_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			showSpinner();
			// clear the states list
			$('#bar_states_list_ul').html('');
			// get the states list
			$.get("http://nationwidebarcrawl.com/mobilenative/destinationstatelist/", function(response) {
				var parsed_data = $.parseJSON(response);
				$.each(parsed_data, function() {
					var chosenstate = this['state'] + '';
					$('#bar_states_list_ul').append('<li><a href="#" onClick="showBarState(\'' + chosenstate + '\')">' + this['name'] + '</a><span class="native_ul_arrow"></span></li>');
				});
				// add click event listener to highlight clicked li
				$('#specials ul li').click(function() {
					$(this).addClass('li_clicked');
				});
				// show the specials states page
				$('#bar_states_page').slideDown('slow', function() {
					setTimeout(function() {
						hideSpinner();
						myScroll.refresh();
					}, 0);
				});
				$('#up_arrow').show();
			});
		}
	}
	
	// display/hide the destination list for selectedstate for the bars button
	function showBarState(selectedstate) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_state_page').is(':visible')) {
			upArrowClicked();
		} else {
			// set chosen state
			window.localStorage.setItem("chosenstate", selectedstate);
			$('.hidden:visible').slideUp('slow');
			// clear bar state list
			$('#bar_state_list_ul').html('');
			showSpinner();
			// variable for when bars db has been created
			var barsDbs = localStorage.getItem("barsDbs");
			barsDbs = String(barsDbs);
			// check if barsDbs is empty
			if (barsDbs && barsDbs != "") {
				if (barsDbs.search(selectedstate)!=-1) {
					db.transaction(queryBarStateDB, errorCB, function(){});
				} else {
					db.transaction(populateBarsStateDB, errorCB, successBarStateCB);
				}
			} else {
				db.transaction(populateBarsStateDB, errorCB, successBarStateCB);
			}
		}
	}
	
	// Populate the database with bar info if bars table not yet created
	function populateBarsStateDB(tx) {
		tx.executeSql('CREATE TABLE IF NOT EXISTS bars(id INTEGER, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website)');
		$.ajaxSetup({async: false});
		// variable to hold selected state
		var selectedstate = window.localStorage.getItem("chosenstate");
		$.get("http://nationwidebarcrawl.com/mobilenative/barstatelist/" + selectedstate + "/", function(response) {
			var parsed_data = $.parseJSON(response);
			var len = parsed_data.length
			var remaining_length = parsed_data.length;
			var begin_counter = 0;
			while (remaining_length > 0) {
				addRowsToBarStateTable(parsed_data.slice(begin_counter, begin_counter+500), tx);
				begin_counter += 500;
				remaining_length -= 500;
			}
			localStorage.setItem("barsDbCreated", "1");
			var donedbs = localStorage.getItem("barsDbs");
			donedbs += ", " + selectedstate;
			localStorage.setItem("barsDbs", donedbs);
		});
	}
	
	// Add rows to the table for each bar
	function addRowsToBarStateTable(bars, tx) {
		for(var i=0;i<bars.length;i++) {
			var bar = bars[i];
			barVarString = [bar['pk'], bar['name'], bar['slug'], bar['location'], bar['address'], bar['destination'], bar['destination_slug'], bar['phone'], bar['city'], bar['state'], bar['statekey'], bar['website']];
			tx.executeSql('INSERT INTO bars (id, name, slug, location, address, destination, destination_slug, phone, city, state, statekey, website) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)', barVarString);
		}
	}
	
	// Bar State DB Success Callback
	function successBarStateCB() {
		db.transaction(queryBarStateDB, errorCB);
	}
	
	// Query the database for bars for bar state list in bars button
	function queryBarStateDB(tx) {
		var selectedstate = window.localStorage.getItem("chosenstate");
		tx.executeSql('SELECT DISTINCT destination, city FROM bars WHERE statekey = ?', [selectedstate], queryBarStateSuccess, errorCB);
	}
	
	// Bar State DB Query Success Callback
	function queryBarStateSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#bar_state_list_ul').append('<li><a href="#" onClick="showBarDestList(\'' + bar.destination + '\')">' + bar.destination + ' - ' + bar.city + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the bar state page
		$('#bar_state_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	
	// display/hide the bar list for the chosen destination on the bars button
	function showBarDestList(selecteddest) {
		// remove the highlighting from any clicked element
		$('#specials ul li').removeClass('li_clicked');
		if ($('#bar_dest_page').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			// set the selected destination
			window.localStorage.setItem("chosendest", selecteddest);
			// clear the bar dest list
			$('#bar_dest_list_ul').html('');
			showSpinner();
			db.transaction(queryBarDestListDB, errorCB, function(){});
		}
	}
	
	// Query the database for the bars list for selected destination
	function queryBarDestListDB(tx) {
		var selecteddest = window.localStorage.getItem("chosendest");
		tx.executeSql('SELECT name, id FROM bars WHERE destination = ?', [selecteddest], queryBarDestListSuccess, errorCB);
	}
	
	// Bars List Query Success Callback for bars button
	function queryBarDestListSuccess(tx, results) {
		var len = results.rows.length;
		for (var i=0; i<len; i++){
			var bar = results.rows.item(i);
			$('#bar_dest_list_ul').append('<li><a href="#" onClick="singleBarClicked(\'' + bar.id + '\')">' + bar.name + '</a><span class="native_ul_arrow"></span></li>');
		}
		// show the bar destination page
		$('#bar_dest_page').slideDown('slow', function() {
			setTimeout(function() {
				hideSpinner();
				myScroll.refresh();
			}, 100);
		});
		$('#up_arrow').show();
	}
	

	//************************************************************
	//
	// LOGIN AND AUTHENTICATION
	//
	//************************************************************
	
	// display/hide the login page
	function loginPageClicked() {
		if ($('#home_login_holder').is(':visible')) {
			upArrowClicked();
		} else {
			myScroll.destroy();
			myScroll = new iScroll('wrapper', {
				useTransform: false,
				onBeforeScrollStart: function (e) {
					var target = e.target;
					while (target.nodeType != 1) target = target.parentNode;

					if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA')
						e.preventDefault();
				}
			});
			$('.hidden:visible').slideUp('slow');
			$('#home_login_holder').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
				reloadindex = true;
				$('#up_arrow').show();
			});
		}
	}

	// handle the login form submission
	$('#login_form').submit(function(event) {
		// stop form from submitting
        event.preventDefault();
        // stop jquery mobile from submitting the form
        event.stopImmediatePropagation();
        //send a post request to your web-service
        $.post("http://nationwidebarcrawl.com/mobilenative/login/", $(this).serialize(), function(response) {
        	$('#login_results').html(response);
            //parse the response string into an object
            var auth_info = $.parseJSON(response);
            //check if the authorization was successful or not
            if (auth_info['status'] == 1) {
                alert('You have been logged in!');
                // set the authenticated variable
                localStorage.setItem("isAuthenticated", "1");
				// reload the index
				window.location.href="./index.html";
            } else {
            	// set the authenticated variable
            	localStorage.setItem("isAuthenticated", "0");
                alert('login failed');
            }
        });
    return false;
    });
    
    // display/hide the register page
	function registerPageClicked() {
		if ($('#home_register_holder').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			$('#home_register_holder').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
				reloadindex = true;
				$('#up_arrow').show();
			});
		}
	}
	
	// deal with register form submit
	$('#register_form').submit(function(event) {
		// stop form from submitting
        event.preventDefault();
        // stop jquery mobile from submitting the form
        event.stopImmediatePropagation();
        
        // fill in birthday field
		var selecteddate = $("#id_month").find(":selected").val();
		selecteddate += "/" + $("#id_day").find(":selected").val();
		selecteddate += "/" + $("#id_year").find(":selected").val();
		$("#id_birthday").val(selecteddate);

	    //send a post request to your web-service
        $.post("http://nationwidebarcrawl.com/mobilenative/register1/", $(this).serialize(), function(response) {
            //parse the response string into an object
            var auth_info = $.parseJSON(response);
            //check if the authorization was successful or not
            if (auth_info['status'] == 6) {
                alert('You have successfully registered.  Time to drink!');
                window.location.href="./index.html";
            }
            // invalid registration code
            if (auth_info['status'] == 2) {
            	alert('Registration Failed.');
            	alert('Sorry Buddy, that Registration Code does not exist.');
            }
            // registration code no longer valid
            if (auth_info['status'] == 3) {
            	alert('Registration Failed.');
            	alert('Sorry Buddy, that Registration Code is no longer valid.');
            }
            // not 21 years old
            if (auth_info['status'] == 4) {
            	alert('Registration Failed.');
            	alert('Sorry Buddy, you have to be 21 to join this site.');
            }
            // username already taken
            if (auth_info['status'] == 5) {
            	alert('Registration Failed.');
            	alert('Sorry Buddy, that Username is already taken, please try another one.');
            }
            // account already exists for that email address
            if (auth_info['status'] == 10) {
            	alert('Registration Failed.');
            	alert('Sorry Buddy, there is already an account registered to that email address.');
            	alert('Try resetting your password.');
            }
            // form did not validate
            if (auth_info['status'] == 7) {
            	alert('Sorry Buddy, you\'re missing a required field.  Are you sure you\'re using a valid registration code?');
            }
            // did not accept TOS
            if (auth_info['status'] == 8) {
            	alert('Error: You must agree to the Terms of Service to register.');
            }
            // invalid id for favorite bar
            if (auth_info['status'] == 9) {
            	alert('Error: Please pick a different favorite bar.');
            }
        });
    return false;
    });
    
    // display/hide the password reset page
	function resetPasswordClicked() {
		if ($('#home_password_reset_holder').is(':visible')) {
			upArrowClicked();
		} else {
			$('.hidden:visible').slideUp('slow');
			$('#home_password_reset_holder').slideDown('slow', function() {
				setTimeout(function() {
					myScroll.refresh();
				}, 0);
				reloadindex = true;
				$('#up_arrow').show();
			});
		}
	}
	
	// handle the password reset form submission
	$('#password_reset_form').submit(function(event) {
		// stop form from submitting
        event.preventDefault();
        // stop jquery mobile from submitting the form
        event.stopImmediatePropagation();
        //send a post request to your web-service
        $.post("http://nationwidebarcrawl.com/mobilenative/passwordreset/", $(this).serialize(), function(response) {
            //parse the response string into an object
            var auth_info = $.parseJSON(response);
            //check if the authorization was successful or not
            if (auth_info['status'] == 1) {
                alert('Password Reset Email sent.  Please check your email.');
				// reload the index
				window.location.href="./index.html";
            } else {
                alert('Password reset failed.');
            }
        });
    return false;
    });

	// logout button click handler
	function logoutbutton() {
		$.get("http://nationwidebarcrawl.com/m/logout/", function() {
			localStorage.setItem("isAuthenticated", "0");
			window.location.href="./index.html";
		});
	}

	//************************************************************
	//
	// ACCESSOR METHODS FOR LEAVING INDEX.HTML
	//
	//************************************************************
	
	// beer clicked, set the chosen beer for beer.html to receive
	function beerClicked(chosenbeer) {
		window.localStorage.setItem("chosenbeer", chosenbeer);
		return true;
	}
	
	// drink clicked, set the chosen drink for drink.html to receive
	function drinkClicked(chosendrink) {
		window.localStorage.setItem("chosendrink", chosendrink); 
		return true;
	}
	
	// bar clicked, set chosen bar for bar.html to receive
	function barClicked(chosenbar) {
		window.localStorage.setItem("chosenbar", chosenbar); 
		return true;
	}
	
	// dest clicked, set chosen dest for bardest.html to receive
	function destClicked(chosendest) {
		window.localStorage.setItem("chosendest", chosendest);
		return true;
	}
	
	// function for clicking a drink type on the drinks page
	function drinktypeClicked(chosentype) {
		window.localStorage.setItem("chosendrinktype", chosentype); 
		return true;
	}
	
	//************************************************************
	//
	// SPINNER IN HEADER FOR LOADING
	//
	//************************************************************
	
	// show the spinner
	function showSpinner() {
		$('#header_logo_loading').attr('src', './images/mobile/header_logo_spinner.gif');
	}
	
	// hide the spinner
	function hideSpinner() {
		$('#header_logo_loading').attr('src', './images/mobile/header_logo_solid.png');
	}

	//************************************************************
	//
	// ERROR HANDLERS FOR DATABASE ACCESS
	//
	//************************************************************

	// Transaction error callback
	function errorCB(err) {
		alert("Error processing SQL: "+err.code);
		alert("Error is: "+err.message);
	}

	// filesystem error callback
	function onError(e) {
		alert('error: ' + e.message);
	}

	// error handler for filesystem access
	function errorHandler(e) {
		var msg = '';
		switch (e.code) {
			case FileError.QUOTA_EXCEEDED_ERR:
				msg = 'QUOTA_EXCEEDED_ERR';
				break;
			case FileError.NOT_FOUND_ERR:
				msg = 'NOT_FOUND_ERR';
				break;
			case FileError.SECURITY_ERR:
				msg = 'SECURITY_ERR';
				break;
			case FileError.INVALID_MODIFICATION_ERR:
				msg = 'INVALID_MODIFICATION_ERR';
				break;
			case FileError.INVALID_STATE_ERR:
				msg = 'INVALID_STATE_ERR';
				break;
			default:
				msg = 'Unknown Error';
				break;
		};
		alert('Error: ' + msg);
	}	
	
	//************************************************************
	//
	// APP INIT FUNCTIONS
	//
	//************************************************************
	
	// Wait for Cordova to load
	//
	document.addEventListener("deviceready", onDeviceReady, true);

	// CORDOVA IS READY! LETS START THIS BEAST UP
	//
	function onDeviceReady() {
		// make sure the beers database has been created first, if not pull the beers down and store them
		if (dbCreated != 1) {
			alert('Beers database must be created before using the app, click OK to create the Beers Database');
			showSpinner();
			$('#home_database_beers').slideDown('slow');
			onBeersMainReady();
		} else {
			// make sure the drinks database has been created first, if not pull the drinks down and save them to the db
			if (drinksdbCreated != 1) {
				alert('Drinks database must be created before using the app, click OK to create the Drinks Database');
				showSpinner();
				$('#home_database_drinks').slideDown('slow');
				onDrinksMainReady();
			}
		}
	
		// get the app init info from the server
		$.get("http://nationwidebarcrawl.com/mobilenative/appinit/", function(response) {
			var parsed_data = $.parseJSON(response);
			
			// If the user is not authenticated
			if (parsed_data[0].status == "0") {
				localStorage.setItem("isAuthenticated", "0");
			}
		
			// User is authenticated - store profile information in browser
			if (parsed_data[0].status == "1") {
				localStorage.setItem("isAuthenticated", "1");
				localStorage.setItem("profileUsername", parsed_data[0].username);
				localStorage.setItem("profilePk", parsed_data[0].pk);
				localStorage.setItem("profileFavBeer", parsed_data[0].favbeer);
				localStorage.setItem("profileFavBeerPk", parsed_data[0].favbeerpk);
				localStorage.setItem("profileFavBeers", parsed_data[0].favbeers);
				localStorage.setItem("profileFavDrink", parsed_data[0].favdrink);
				localStorage.setItem("profileFavDrinkPk", parsed_data[0].favdrinkpk);
				localStorage.setItem("profileFavDrinks", parsed_data[0].favdrinks);
				localStorage.setItem("profileFavBar", parsed_data[0].favbar);
				localStorage.setItem("profileFavBarPk", parsed_data[0].favbarpk);
				localStorage.setItem("profileFavDest", parsed_data[0].favdest);
				localStorage.setItem("profileFavDestPk", parsed_data[0].favdestpk);
				localStorage.setItem("profileFavDestSlug", parsed_data[0].favdestslug);
				localStorage.setItem("profileImage", parsed_data[0].image);
			
				// if not set, set initial slot machine values
				if (localStorage.getItem("slotdest") == null) {
					localStorage.setItem("slotdest", parsed_data[0].favdest);
					localStorage.setItem("slotdestslug", parsed_data[0].favdestslug);
				}
			
				// if not set, set initial drink specials values
				if (localStorage.getItem("specialsdest") == null) {
					localStorage.setItem("specialsdest", parsed_data[0].favdest);
					localStorage.setItem("specialsdestslug", parsed_data[0].favdestslug);
				}
			
				// if not set, set initial chosen destination
				if (localStorage.getItem("chosendest") == null) {
					localStorage.setItem("chosendest", parsed_data[0].favdest);
				}
				if (localStorage.getItem("chosendestslug") == null) {
					localStorage.setItem("chosendestslug", parsed_data[0].favdestslug);
				}
			
				// if user has friend requests, show friend requests button
				if (parsed_data[0].friendship_requests == true) {
					$('#home_buttons_conditional_friendship').removeClass('hidden');
				}
			
				// if user hasnt taken the weekly poll, show weekly poll button
				if (parsed_data[0].weeklypoll == true) {
					$('#home_buttons_conditional_weeklypoll').removeClass('hidden');
				}
			
				// if logged in, add the logout button
				$('#logout_holder').append('<p><a href="#" onClick="logoutbutton()"><img src="./images/mobile/logout.png" /></p>');
			}
		});
	}
	
	//************************************************************
	//
	// The End!
	// Hope you enjoyed it.
	// Check out some of my other work at:
	// http://www.HackedExistence.com
	//
	//************************************************************
</script>
</body>
</html>